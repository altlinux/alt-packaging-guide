<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Adam Miller, Maxim Svistunov, Marie Doleželová, и другие.">
<title>Руководство по сборке RPM пакетов</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Руководство по сборке RPM пакетов</h1>
<div class="details">
<span id="author" class="author">Adam Miller, Maxim Svistunov, Marie Doleželová, и другие.</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Вступление</a>
<ul class="sectlevel2">
<li><a href="#pdf-version">PDF Версия</a></li>
<li><a href="#document-conventions">Файловая структура</a></li>
<li><a href="#contributing-to-this-guide">Вклад в руководство</a></li>
</ul>
</li>
<li><a href="#prerequisites">Необходимые пакеты</a></li>
<li><a href="#Why-Package-Software-with-RPM">Зачем упаковывать программное обеспечение с помощью RPM?</a></li>
<li><a href="#hello-world">Ваш Первый пакет RPM</a></li>
<li><a href="#preparing-software-for-packaging">Подготовка программного обеспечения для упаковки</a>
<ul class="sectlevel2">
<li><a href="#what-is-source-code">Что такое Исходный код?</a></li>
<li><a href="#how-programs-are-made">Как создаются программы</a>
<ul class="sectlevel3">
<li><a href="#natively-compiled-code">Изначально скомпилированный код</a></li>
<li><a href="#interpreted-code">Интерпретируемый код</a></li>
</ul>
</li>
<li><a href="#building-software-from-source">Создание программного обеспечения из исходного кода</a>
<ul class="sectlevel3">
<li><a href="#natively-compiled-code-building-software-from-source">Изначально скомпилированный код</a></li>
<li><a href="#interpreted-code-building-software-from-source">Интерпретируемый код</a></li>
</ul>
</li>
<li><a href="#patching-software">Программное обеспечение для исправления ошибок</a></li>
<li><a href="#installing-arbitrary-artifacts">Установка Произвольных Артефактов</a>
<ul class="sectlevel3">
<li><a href="#install-command">Использование команды install</a></li>
<li><a href="#make-install">Использование команды make install</a></li>
</ul>
</li>
<li><a href="#preparing-source-code-for-packaging">Подготовка исходного кода для упаковки</a></li>
<li><a href="#putting-source-code-into-tarball">Создание Tarball с исходным кодом</a>
<ul class="sectlevel3">
<li><a href="#bello">bello</a></li>
<li><a href="#pello">pello</a></li>
<li><a href="#cello">cello</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#packaging-software">Программное обеспечение для упаковки</a>
<ul class="sectlevel2">
<li><a href="#rpm-packages">RPM Пакеты</a>
<ul class="sectlevel3">
<li><a href="#what-is-an-rpm">Что такое RPM?</a></li>
<li><a href="#rpm-packaging-tools">RPM Packaging Tools</a></li>
<li><a href="#rpm-packaging-workspace">Рабочее пространство для упаковки RPM</a></li>
<li><a href="#what-is-a-spec-file">Что такое SPEC файл?</a></li>
<li><a href="#buildroots">BuildRoots</a></li>
<li><a href="#rpm-macros">RPM Макросы</a></li>
<li><a href="#working-with-spec-files">Работа со SPEK файлами</a></li>
</ul>
</li>
<li><a href="#building-rpms">Создание RPMS</a>
<ul class="sectlevel3">
<li><a href="#source-rpms">Исходный RPMs</a></li>
<li><a href="#binary-rpms">Бинарный RPMS</a></li>
</ul>
</li>
<li><a href="#checking-rpms-for-sanity">Проверка RPMs на корректность</a>
<ul class="sectlevel3">
<li><a href="#checking-bello-spec-file">Проверка SPEC файла bello</a></li>
<li><a href="#checking-bello-binary-rpm">Проверка бинарного RPM bello</a></li>
<li><a href="#checking-pello-spec-file">Проверка SPEC файла pello</a></li>
<li><a href="#checking-pello-binary-rpm">Проверка бинарного RPM pello</a></li>
<li><a href="#checking-cello-spec-file">Проверка SPEC файла cello</a></li>
<li><a href="#checking-cello-binary-rpm">Проверка бинарного RPM cello</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#advanced-topics">Дополнительные материалы</a>
<ul class="sectlevel2">
<li><a href="#Signing-Packages">Подпись пакетов</a>
<ul class="sectlevel3">
<li><a href="#Adding-a-Signature-to-a-Package">Добавление подписи к пакету</a></li>
<li><a href="#Replacing-a-Package-Signature">Замена подписи пакета</a></li>
<li><a href="#Build-time-Signing">Подпись во время сборки</a></li>
</ul>
</li>
<li><a href="#mock">Mock</a></li>
<li><a href="#version-control-systems">Система контроля версий</a>
<ul class="sectlevel3">
<li><a href="#tito">tito</a></li>
<li><a href="#dist-git">dist-git</a></li>
</ul>
</li>
<li><a href="#more-on-macros">Подробнее о макросах</a>
<ul class="sectlevel3">
<li><a href="#defining-your-own">Определение Ваших Собственных Макросов</a></li>
<li><a href="#setup">%setup</a></li>
<li><a href="#files">%files</a></li>
<li><a href="#built-in-macros">Встроенные макросы</a></li>
<li><a href="#rpm-distribution-macros">RPM Distribution Macros</a></li>
</ul>
</li>
<li><a href="#custom-macros">Пользовательские макросы</a></li>
<li><a href="#epoch-scriptlets-and-triggers">Epoch, Scriptlets, and Triggers</a>
<ul class="sectlevel3">
<li><a href="#epoch">Epoch</a></li>
<li><a href="#triggers-and-scriptlets">Scriptlets and Triggers</a></li>
</ul>
</li>
<li><a href="#rpm-conditionals">Условные обозначения RPM</a>
<ul class="sectlevel3">
<li><a href="#_rpm_conditionals_syntax">RPM Conditionals Syntax</a></li>
<li><a href="#_примеры_условных_обозначений_rpm">Примеры условных обозначений RPM</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_новые_возможности_rpm_в_rhel_7">Appendix A: Новые возможности RPM в RHEL 7</a></li>
<li><a href="#_ссылки_на_источники">Appendix B: Ссылки на источники</a></li>
<li><a href="#_выражение_благодарности">Appendix C: Выражение благодарности</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Вступление</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Руководство по упаковке RPM пакетов:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Как подготовить исходный код для упаковки в RPM.</dt>
<dd>
<p>Для тех, кто не имеет опыта разработки программного обеспечения.
<a href="#preparing-software-for-packaging">Подготовка программного обеспечения для упаковки</a>.</p>
</dd>
<dt class="hdlist1">Как упаковать исходный код в RPM.</dt>
<dd>
<p>Это для разработчиков программного обеспечения, которым необходимо упаковать программное обеспечение в RPMs. <a href="#packaging-software">Программное обеспечение для упаковки</a>.</p>
</dd>
<dt class="hdlist1">Расширенные сценарии упаковки.</dt>
<dd>
<p>Это справочный материал для упаковщиков RPM, работающих с расширенными сценариями упаковки RPM.
<a href="#advanced-topics">Дополнительные материалы</a>.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="pdf-version">PDF Версия</h3>
<div class="paragraph">
<p>Вы также можете скачать
<a href="https://rpm-packaging-guide.github.io/rpm-packaging-guide.pdf">PDF версию
данного документа</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions">Файловая структура</h3>
<div class="paragraph">
<p>Перед тем, как приступить к сборке, нужно создать структуру каталогов, необходимую RPM, находящуюся в Вашем «домашнем» каталоге:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Выходные данные команд и содержимое текстовых файлов, включая исходный код, размещаются в блоках:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tree ~/rpmbuild/
/home/user/rpmbuild/
|-- BUILD
|-- BUILDROOT
|-- RPMS
|   |-- i586
|   |-- x86_64
|   `-- noarch
|-- SOURCES
|-- SPECS
`-- SRPMS

[command output trimmed]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">Name:           bello
Version:
Release:        1%{?dist}
Summary:

[file contents trimmed]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">#!/usr/bin/env python

print("Hello World")</code></pre>
</div>
</div>
</li>
<li>
<p>Темы, представляющие интерес, или словарные термины упоминаются либо как ссылки на соответствующую документацию или веб-сайт, выделенные <strong>жирным</strong> шрифтом, либо <em>курсивом</em>. Первые упоминания некоторых терминов ссылаются на соответствующую документацию.
The first occurrences of some terms link to their respective documentation.</p>
</li>
<li>
<p>Названия утилит, команд и других элементов, обычно встречающихся в коде, написаны <code>моноширинным</code> шрифтом.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="contributing-to-this-guide">Вклад в руководство</h3>
<div class="paragraph">
<p>Вы можете внести свой вклад в это руководство, отправив сообщение о проблеме или запрос на извлечение наn
<a href="https://github.com/redhat-developer/rpm-packaging-guide"> GitHub репозиторий</a>.</p>
</div>
<div class="paragraph">
<p>Обе формы вклада высоко ценятся и приветствуются.</p>
</div>
<div class="paragraph">
<p>Не стесняйтесь подавать заявку на решение проблемы с обратной связью, отправлять запрос на извлечение
<a href="https://github.com/redhat-developer/rpm-packaging-guide">на GitHub</a> или и то, и другое!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites">Необходимые пакеты</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Чтобы следовать этому руководству, вам понадобятся пакеты, упомянутые ниже.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Некоторые из этих пакетов устанавливаются по умолчанию в
<a href="https://getfedora.org/">Fedora</a>, <a href="https://www.centos.org/">CentOS</a> и
<a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a>.
Они подробно перечислины, чтобы показать, какие инструменты используются в этом руководстве.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>В Fedora, CentOS 8, и RHEL 8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ dnf install gcc rpm-build rpm-devel rpmlint make python bash coreutils diffutils patch rpmdevtools</code></pre>
</div>
</div>
<div class="paragraph">
<p>В CentOS 7 и RHEL 7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ yum install gcc rpm-build rpm-devel rpmlint make python bash coreutils diffutils patch rpmdevtools</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Why-Package-Software-with-RPM">Зачем упаковывать программное обеспечение с помощью RPM?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Менеджер пакетов RPM (RPM) - это система управления пакетами, которая работает на Red Hat Enterprise Linux, CentOS и Fedora. RPM упрощает распространение, управление и обновление программного обеспечения, создаваемого для Red Hat Enterprise Linux, CentOS и Fedora. Многие поставщики программного обеспечения распространяют свое программное обеспечение через обычный архивный файл (например, архивный файл). Однако упаковка программного обеспечения в пакеты RPM имеет ряд преимуществ. Эти преимущества описаны ниже.</p>
</div>
<div class="paragraph">
<p>С помощью RPM вы можете:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Устанавливать, переустанавливать, удалять, обновлять и проверять пакеты</dt>
<dd>
<p>Пользователи могут использовать стандартные средства управления пакетами (например, Yum или PackageKit) для установки, переустановки, удаления, обновления и проверки ваших пакетов RPM.</p>
</dd>
<dt class="hdlist1">Использовать базу данных установленных пакетов для запроса и проверки пакетов</dt>
<dd>
<p>Поскольку RPM поддерживает базу данных установленных пакетов и их файлов, пользователи могут легко запрашивать и проверять пакеты в своей системе.</p>
</dd>
<dt class="hdlist1">Использовать метаданные для описания пакетов, инструкций по их установке и т. д.</dt>
<dd>
<p>Каждый пакет RPM содержит метаданные, описывающие компоненты пакета, версию, выпуск, размер, URL-адрес проекта, инструкции по установке и так далее</p>
</dd>
<dt class="hdlist1">Упаковывать нетронутые исходные коды программного обеспечения в исходные и двоичные пакеты</dt>
<dd>
<p>RPM позволяет вам брать нетронутые исходные коды программного обеспечения и упаковывать их в исходные и двоичные пакеты для ваших пользователей. В исходных пакетах у Вас есть первозданные исходные тексты вместе с любыми использованными исправлениями, а также полные инструкции по сборке. Такая конструкция облегчает обслуживание пакетов по мере выпуска новых версий вашего программного обеспечения.</p>
</dd>
<dt class="hdlist1">Добавлять пакеты в репозитории Yum</dt>
<dd>
<p>Вы можете добавить свой пакет в репозиторий Yum, который позволяет клиентам легко находить и развертывать ваше программное обеспечение.</p>
</dd>
<dt class="hdlist1">Установить цифровую подпись Ваших упаковок</dt>
<dd>
<p>Используя ключ подписи GPG, Вы можете подписать посылку цифровой подписью, чтобы пользователи могли проверить подлинность упаковки.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hello-world">Ваш Первый пакет RPM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Создание пакета RPM может быть сложным. Вот полный рабочий файл спецификации RPM, в котором несколько вещей пропущены и упрощены.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:       hello-world
Version:    1
Release:    1
Summary:    Most simple RPM package
License:    FIXME

%description
This is my first RPM package, which does nothing.

%prep
# we have no source, so nothing here

%build
cat &gt; hello-world.sh &lt;&lt;EOF
#!/usr/bin/bash
echo Hello world
EOF

%install
mkdir -p %{buildroot}/usr/bin/
install -m 755 hello-world.sh %{buildroot}/usr/bin/hello-world.sh

%files
/usr/bin/hello-world.sh

%changelog
# let's skip this for now</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сохраните этот файл как <code>hello-world.spec</code>.</p>
</div>
<div class="paragraph">
<p>Теперь используйте эти команды:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmdev-setuptree
$ rpmbuild -ba hello-world.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>Команда <code>rpmdev-setuptree</code> создает несколько рабочих каталогов. Поскольку эти каталоги постоянно хранятся в $HOME, эту команду не нужно использовать снова.</p>
</div>
<div class="paragraph">
<p>Команда  <code>rpmbuild</code> создает фактический пакет rpm. Вывод этой команды может быть похож на:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">... [SNIP]
Wrote: /home/mirek/rpmbuild/SRPMS/hello-world-1-1.src.rpm
Wrote: /home/mirek/rpmbuild/RPMS/x86_64/hello-world-1-1.x86_64.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.wgaJzv
+ umask 022
+ cd /home/mirek/rpmbuild/BUILD
+ /usr/bin/rm -rf /home/mirek/rpmbuild/BUILDROOT/hello-world-1-1.x86_64
+ exit 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Файл <code>/home/mirek/rpmbuild/RPMS/x86_64/hello-world-1-1.x86_64.rpm</code> является вашим первым пакетом RPM. Его можно установить в систему и протестировать.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-software-for-packaging">Подготовка программного обеспечения для упаковки</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Эта глава посвящена исходному коду и созданию программного обеспечения, которые являются необходимой основой для RPM-упаковщика.</p>
</div>
<div class="sect2">
<h3 id="what-is-source-code">Что такое Исходный код?</h3>
<div class="paragraph">
<p><strong>Исходный код </strong> - это понятные для человека инструкции к компьютеру, в которых описывается, как выполнить вычисления. Исходный код выражается с помощью
<a href="https://en.wikipedia.org/wiki/Programming_language">языка программирования</a>
.</p>
</div>
<div class="paragraph">
<p>В этом руководстве представлены три версии  <code>Hello World</code> программы, каждая из которых написана на разных языках программирования. Программы, написанные на этих трех разных языках, упаковываются по-разному и охватывают три основных варианта использования RPM-упаковщика.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Существуют тысячи языков программирования. В этом документе представлены только три из них, но их достаточно для концептуального обзора.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Hello World</code> написано на <a href="https://www.gnu.org/software/bash/">bash</a>:</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf "Hello World\n"</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Hello World</code> написано на <a href="https://www.python.org/">Python</a>:</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">#!/usr/bin/env python

print("Hello World")</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Hello World</code> написано на
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
:</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">#include &lt;stdio.h&gt;

int main(void) {
    printf("Hello World\n");
    return 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Целью каждой из трех программ является вывод <code>Hello World</code> в
 командной строке.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Знание того, как программировать, не обязательно для упаковщика программного обеспечения, но полезно.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="how-programs-are-made">Как создаются программы</h3>
<div class="paragraph">
<p>Существует множество методов, с помощью которых читаемый человеком исходный код становится машинным кодом - инструкциями, которым компьютер следует для фактического выполнения программы. Однако все методы можно свести к этим трем:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Программа изначально скомпилирована..</p>
</li>
<li>
<p>Программа интерпретируется с помощью необработанной интерпретации.</p>
</li>
<li>
<p>Программа интерпретируется путем байтовой компиляции.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="natively-compiled-code">Изначально скомпилированный код</h4>
<div class="paragraph">
<p><strong>Изначально скомпилированное</strong> программное обеспечение - это программное обеспечение, написанное на языке программирования, которое компилируется в машинный код с результирующим двоичным исполняемым файлом. Такое программное обеспечение можно запускать автономно.</p>
</div>
<div class="paragraph">
<p>Пакеты RPM, созданные таким образом, зависят от
<a href="https://en.wikipedia.org/wiki/Microarchitecture">архитектуры</a>
 Это означает, что если вы скомпилируете такое программное обеспечение на компьютере, использующем 64-разрядный (x86_64) процессор AMD или Intel, оно не будет выполняться на 32-разрядном (x86) процессоре AMD или Intel. В названии результирующего пакета будет указана архитектура.</p>
</div>
</div>
<div class="sect3">
<h4 id="interpreted-code">Интерпретируемый код</h4>
<div class="paragraph">
<p>Некоторые языки программирования, такие как <a href="https://www.gnu.org/software/bash/">bash</a> или <a href="https://www.python.org/">Python</a>, не компилируются в машинный код. Вместо этого исходный код их программ выполняется шаг за шагом, без предварительных преобразований,
<a href="https://en.wikipedia.org/wiki/Interpreter_%28computing%29">языковым интерпритатором</a>
или языковой виртуальной машиной.</p>
</div>
<div class="paragraph">
<p>Программное обеспечение, написанное полностью на интерпретируемых языках программирования, не зависит от
<a href="https://en.wikipedia.org/wiki/Microarchitecture">архитектуры</a>
Следовательно, результирующий пакет RPM будет иметь строку <code>noarch</code> в своем названии.</p>
</div>
<div class="paragraph">
<p>Существует два типа интерпретируемых языков: <strong>байт-скомпилированные</strong> и <strong>необработанные интерпретируемые</strong>. Процесс сборки программ для этих двух типов отличается.</p>
</div>
<div class="sect4">
<h5 id="_программы_с_интерпретацией_raw">Программы с интерпретацией Raw</h5>
<div class="paragraph">
<p>Программы на языке с интерпретацией Raw вообще не нужно компилировать, они выполняются непосредственно интерпретатором.</p>
</div>
</div>
<div class="sect4">
<h5 id="_программы_скомпилированные_в_байтах">Программы, скомпилированные в байтах</h5>
<div class="paragraph">
<p>Языки, скомпилированные в байтах, должны быть скомпилированы в байтовый код, который затем выполняется виртуальной машиной языка.e.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Некоторые языки предоставляют выбор: они могут быть интерпретированы в формате raw или скомпилированы в байтах.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-software-from-source">Создание программного обеспечения из исходного кода</h3>
<div class="paragraph">
<p>В этом разделе объясняется сборка программного обеспечения на основе его исходного кода.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для программного обеспечения, написанного на скомпилированных языках, исходный код проходит процесс <strong>сборки</strong>, создавая машинный код. Этот процесс, обычно называемый <strong>компиляцией</strong> или <strong>переводом</strong>, различается для разных языков. Полученное встроенное программное обеспечение может быть <strong>запущено</strong> или "<strong>выполнено</strong>", что заставляет компьютер выполнять задачу, указанную программистом.</p>
</li>
<li>
<p>Для программного обеспечения, написанного на необработанных интерпретируемых языках, исходный код не создается, а выполняется напрямую.</p>
</li>
<li>
<p>Для программного обеспечения, написанного на интерпретируемых языках с байтовой компиляцией, исходный код компилируется в байтовый код, который затем выполняется виртуальной машиной языка.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="natively-compiled-code-building-software-from-source">Изначально скомпилированный код</h4>
<div class="paragraph">
<p>В этом примере вы создадите <code>cello.c</code> программу, написанную на языке
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
в исполняемый файл.</p>
</div>
<div class="paragraph">
<p><code>cello.c</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">#include &lt;stdio.h&gt;

int main(void) {
    printf("Hello World\n");
    return 0;
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="manual-building">Ручная сборка</h5>
<div class="paragraph">
<p>Вызовите компилятор
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
из коллекции компиляторов GNU  (<a href="https://gcc.gnu.org/">GCC</a>) чтобы скомпилировать исходный код в двоичный файл:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gcc -g -o cello cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Выполните результирующий двоичный файл вывода<code>cello</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вот и все. Вы создали и запустили изначально скомпилированное программное обеспечение из исходного кода.</p>
</div>
</div>
<div class="sect4">
<h5 id="_автоматическая_сборка">Автоматическая сборка</h5>
<div class="paragraph">
<p>Вместо того, чтобы создавать исходный код вручную, вы можете автоматизировать сборку. Это обычная практика, используемая в крупномасштабном программном обеспечении. Автоматизация сборки осуществляется путем создания  <code>Makefile</code> и затем запускаем
<a href="http://www.gnu.org/software/make/">GNU <code>make</code></a> utility.</p>
</div>
<div class="paragraph">
<p>Чтобы настроить автоматическую сборку, создайте файл с именем  <code>Makefile</code> в том же каталоге, что и<code>cello.c</code>:</p>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -g -o cello cello.c

clean:
        rm cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь, чтобы собрать программу, просто запустите <code>make</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
make: 'cello' is up to date.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Посколько сборка уже создана, <code>make clean</code> очистит её, а затем снова запустит <code>make</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make clean
rm cello

$ make
gcc -g -o cello cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Опять же, попытка сборки после другой сборки ничего не даст:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
make: 'cello' is up to date.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наконец, программа выполнится:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь вы скомпилировали программу как вручную, так и с помощью инструмента сборки.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interpreted-code-building-software-from-source">Интерпретируемый код</h4>
<div class="paragraph">
<p>Следующие два примера демонстрируют байтовую компиляцию программы, написанной на
<a href="https://www.python.org/">Python</a> и raw - интерпретация программы, написанной на
<a href="https://www.gnu.org/software/bash/">bash</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>В двух приведенных ниже примерах<code>#!</code> строка в верхней части файла называется
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
и не является частью исходного кода языка программирования.</p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
позволяет использовать текстовый файл в качестве исполняемого файла: загрузчик системной программы анализирует строку, содержащую <strong>shebang</strong>, чтобы получить путь к двоичному исполняемому файлу, который затем используется в качестве интерпретатора языка программирования.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="byte-compiled-code">Скомпилированный в байт-код</h5>
<div class="paragraph">
<p>В этом примере вы скомпилируете  <code>pello.py</code> - программу, написанную на Python в виде байт-кода, который затем выполняется виртуальной машиной на языке Python. Исходный код Python также может быть интерпретирован в формате raw, но версия, скомпилированная в байтах, быстрее. Следовательно, упаковщики RPM предпочитают упаковывать версию, скомпилированную в байтах, для распространения среди конечных пользователей.</p>
</div>
<div class="paragraph">
<p><code>pello.py</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">#!/usr/bin/env python

print("Hello World")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Процедура байтовой компиляции программ отличается для разных языков. Это зависит от языка, виртуальной машины языка, а также инструментов и процессов, используемых с этим языком.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<a href="https://www.python.org/">Python</a> часто компилируется в бай-код, но не так, как описано здесь. Следующая процедура направлена не на то, чтобы соответствовать стандартам сообщества, а на то, чтобы быть простой. Для получения практических рекомендаций по Python см. раздел
<a href="https://docs.python.org/2/library/distribution.html">Упаковка и распространение программного обеспечения</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Байтовая компиляция <code>pello.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ python -m compileall pello.py

$ file pello.pyc
pello.pyc: python 2.7 byte-compiled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Выполните байт-код в <code>pello.pyc</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ python pello.pyc
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="raw-interpreted">Необработанный интерпретируемый код</h5>
<div class="paragraph">
<p>В этом примере вы будете интерпретировать программу <code>bello</code> написанную на встроенном языке оболочки
<a href="https://www.gnu.org/software/bash/">bash</a>.</p>
</div>
<div class="paragraph">
<p><code>bello</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash

printf "Hello World\n"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Программы, написанные на языках сценариев оболочки, таких как  <em>bash</em>, интерпретируются в необработанном виде.
Следовательно, вам нужно только сделать файл с исходным кодом исполняемым и запустить его:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ chmod +x bello
$ ./bello
Hello World</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="patching-software">Программное обеспечение для исправления ошибок</h3>
<div class="paragraph">
<p><strong>Patch</strong> - это исходный код, который исправляет другой исходный код. Он отформатирован как <em>diff</em>, потому что представляет разницу между двумя версиями текста. Разница создаётся с помощью утилиты <code>diff</code>, которая затем применяется к исходному коду с помощью утилиты <a href="http://savannah.gnu.org/projects/patch/">patch</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Разработчики программного обеспечения часто используют системы контроля версий, такие как <a href="https://git-scm.com/">git</a>, для управления своей кодовой базой. Такие инструменты предоставляют свои собственные методы создания различий или исправления программного обеспечения.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>В следующем примере мы создаем исправление из исходного исходного кода с помощью
<code>diff</code>, а затем используем <code>patch</code>. Исправление использует в следующих разделяах при создании RPM и работе со .spec-файлом. <a href="#working-with-spec-files">Работа со SPEK файлами</a>.</p>
</div>
<div class="paragraph">
<p>Как исправление связано с упаковкой RPM? В упаковке, вместо того, чтобы просто изменять исходный исходный код, мы сохраняем его и используем на нем исправления.</p>
</div>
<div class="paragraph">
<p>Чтобы создать патч для <code>cello.c</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Сохраним оригинальный исходный код:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c cello.c.orig</code></pre>
</div>
</div>
<div class="paragraph">
<p>Это наиболее распространённый способ сохранить файл исходного кода</p>
</div>
</li>
<li>
<p>Изменим<code>cello.c</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c">#include &lt;stdio.h&gt;

int main(void) {
    printf("Hello World from my very first patch!\n");
    return 0;
}</code></pre>
</div>
</div>
</li>
<li>
<p>Сгенерируем патч используя утилиту <code>diff</code>:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Мы используем несколько общих аргументов для утилиты <code>diff</code>. Для получения дополнительной информации о них см. руководство по использованию <code>diff</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="diff">$ diff -Naur cello.c.orig cello.c
--- cello.c.orig        2016-05-26 17:21:30.478523360 -0500
+++ cello.c     2016-05-27 14:53:20.668588245 -0500
@@ -1,6 +1,6 @@
 #include&lt;stdio.h&gt;

 int main(void){
-    printf("Hello World!\n");
+    printf("Hello World from my very first patch!\n");
     return 0;
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Строки, начинающиеся с <code>-</code> удалятся из исходного кода и заменятся на строки, начинающихся с  <code>+</code>.</p>
</div>
</li>
<li>
<p>Сохраним патч в файл:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ diff -Naur cello.c.orig cello.c &gt; cello-output-first-patch.patch</code></pre>
</div>
</div>
</li>
<li>
<p>Восстановим исходный код <code>cello.c</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cp cello.c.orig cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Мы сохраняем исходный файл <code>cello.c</code>, потому что при создании RPM используется исходный файл, а не измененный. Дополнительные сведения см. в разделе
<a href="#Работа со SPEC-файлом">[Работа со SPEC-файлом]</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Чтобы исправить <code>cello.c</code> с помощью <code>cello-output-first-patch.patch</code>, перенаправьте патч-файл <code>patch</code> коммандой:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ patch &lt; cello-output-first-patch.patch
patching file cello.c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Содержимое <code>cello.c</code> теперь отражает изменения:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat cello.c
#include&lt;stdio.h&gt;

int main(void){
    printf("Hello World from my very first patch!\n");
    return 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы собрать и запустить отредактированную <code>cello.c</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make clean
rm cello

$ make
gcc -g -o cello cello.c

$ ./cello
Hello World from my very first patch!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вы создали патч, отредактировали программу, собрали отредактированную программу и запустили её.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-arbitrary-artifacts">Установка Произвольных Артефактов</h3>
<div class="paragraph">
<p>Большим преимуществом
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a>
и других Unix-подобных систем является
<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Стандарт иерархии файловой системы</a>
. Он указывает, в каком каталоге должны быть расположены файлы.
Файлы, установленные из пакетов RPM, должны быть размещены в соответствии с ИФС. Например, исполняемый файл должен находиться в каталоге, который находится в переменной
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">PATH</a>
.</p>
</div>
<div class="paragraph">
<p>В контексте этого руководства, <em>Произвольный артефакт</em> - это все, что устанавливается из RPM в систему. Для RPM и для системы это может быть скрипт, двоичный файл, скомпилированный из исходного кода пакета, предварительно скомпилированный двоичный файл или любой другой файл.</p>
</div>
<div class="paragraph">
<p>Мы рассмотрим два популярных способа размещения <em>произвольных артефактов</em> в системе: с помощью команды <code>install</code> и с помощью команды <code>make install</code>.</p>
</div>
<div class="sect3">
<h4 id="install-command">Использование команды install</h4>
<div class="paragraph">
<p>Иногда с помощью инструментов автоматизации сборки, таких как
<a href="http://www.gnu.org/software/make/">GNU make</a> не является оптимальным - например, если упакованная программа проста. В этих случаях упаковщики часто используют команду <code>install</code> (предоставляемая системе
<a href="http://www.gnu.org/software/coreutils/coreutils.html">coreutils</a>), которая помещает артефакт в указанный каталог в файловой системе с указанным набором разрешений.</p>
</div>
<div class="paragraph">
<p>В приведенном ниже примере будет использоваться файл <code>bello</code>  который мы ранее создали в качестве произвольного артефакта, зависящего от нашего метода установки.  Обратите внимание, что вам либо понадобятся разрешения  <a href="http://www.sudo.ws/">sudo</a>, либо запустите эту команду от имени root, исключая часть команды <code>sudo</code>.</p>
</div>
<div class="paragraph">
<p>В этом примере <code>install</code> помещает файл <code>bello</code> в <code>/usr/bin</code> с разрешениями, общими для исполняемых скриптов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo install -m 0755 bello /usr/bin/bello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь<code>bello</code> находится в каталоге, который указан в переменной
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>
. Таким образом, Вы можете запустить <code>bello</code> из любого каталога, не указывая его путь:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~

$ bello
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="make-install">Использование команды make install</h4>
<div class="paragraph">
<p>Популярным автоматизированным способом установки встроенного программного обеспечения в систему является использование команды <code>make install</code>. Вы указываете, как установить произвольные артефакты в систему в файле <code>Makefile</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Обычно <code>Makefile</code> пишется разработчиком, а не упаковщиком.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Добавьте секцию <code>install</code> в <code>Makefile</code>:</p>
</div>
<div class="paragraph">
<p><code>Makefile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">cello:
        gcc -g -o cello cello.c

clean:
        rm cello

install:
        mkdir -p $(DESTDIR)/usr/bin
        install -m 0755 cello $(DESTDIR)/usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Переменная <a href="https://www.gnu.org/software/make/manual/html_node/DESTDIR.html">$(DESTDIR)</a>
является встроенной в  <a href="http://www.gnu.org/software/make/">GNU make</a> и обычно используется для указания установки в каталог, отличный от корневого каталога.</p>
</div>
<div class="paragraph">
<p>Теперь вы можете использовать <code>Makefile</code> не только для создания программного обеспечения, но и для его установки в целевую систему.</p>
</div>
<div class="paragraph">
<p>Для сборки и установки программы <code>cello.c</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ make
gcc -g -o cello cello.c

$ sudo make install
install -m 0755 cello /usr/bin/cello</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь<code>cello</code> находится в каталоге, который указан в переменной
<a href="https://en.wikipedia.org/wiki/PATH_%28variable%29">$PATH</a>
. Таким образом, Вы можете запустить <code>cello</code> из любого каталога, не указывая его полный путь.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~

$ cello
Hello World</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вы установили артефакт сборки в выбранное место в системе.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="preparing-source-code-for-packaging">Подготовка исходного кода для упаковки</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Код, созданный в этом разделе, можно найти
<a href="https://github.com/redhat-developer/rpm-packaging-guide/tree/master/example-code">здесь</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Разработчики часто распространяют программное обеспечение в виде сжатых архивов исходного кода, которые затем используются для создания пакетов. В этом разделе Вы создадите такие архивы.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Создание архивов исходного кода обычно выполняется не RPM-упаковщиком, а разработчиком. Упаковщик работает с готовым архивом исходного кода.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Программное обеспечение должно распространяться с
<a href="https://en.wikipedia.org/wiki/Software_license">лицензией</a>
. Для примера мы будем использовать лицензию
<a href="https://www.gnu.org/licenses/quick-guide-gplv3.html">GPLv3</a>. Текст лицензии помещается в файл <code>LICENSE</code>, для каждой из примеров программ. Упаковщику RPM необходимо иметь дело с файлами лицензий при упаковке.</p>
</div>
<div class="paragraph">
<p>Для использования со следующими примерами создайте файл  <code>LICENSE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat /tmp/LICENSE
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="putting-source-code-into-tarball">Создание Tarball с исходным кодом</h3>
<div class="paragraph">
<p>В приведенных ниже примерах мы помещаем каждую из трех программ  <code>Hello World</code> в архив, сжатый с помощью
<a href="https://www.gnu.org/software/gzip/">gzip</a>. Программное обеспечение часто выпускается таким образом, чтобы позже быть упакованным для распространения.</p>
</div>
<div class="sect3">
<h4 id="bello">bello</h4>
<div class="paragraph">
<p>Проект <em>bello</em> реализует <code>Hello World</code> в
<a href="https://www.gnu.org/software/bash/">bash</a>. Реализация содержит только сценарий оболочки <code>bello</code>, поэтому результирующий  <code>tar.gz</code> aархив будет содержать только один файл, кроме файла  <code>LICENSE</code>. Давайте предположим, что это версия программы - <code>0.1</code></p>
</div>
<div class="paragraph">
<p>Подготовьте проект <em>bello</em> для распространения:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Поместите файлы в один каталог:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/bello-0.1

$ mv ~/bello /tmp/bello-0.1/

$ cp /tmp/LICENSE /tmp/bello-0.1/</code></pre>
</div>
</div>
</li>
<li>
<p>Создайте архив для распространения и переместите его в <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf bello-0.1.tar.gz bello-0.1
bello-0.1/
bello-0.1/LICENSE
bello-0.1/bello

$ mv /tmp/bello-0.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="pello">pello</h4>
<div class="paragraph">
<p>Проект <em>pello</em> реализует <code>Hello World</code> на
<a href="https://www.python.org/">Python</a>. Реализация содержит только программу
<code>pello.py</code>, так что результирующий <code>tar.gz</code> будет содержать только один файл, кроме файла  <code>LICENSE</code>. Предположим, что это версия программы -
<code>0.1.1</code></p>
</div>
<div class="paragraph">
<p>Prepare the <em>pello</em> project for distribution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Поместите файлы в один каталог:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/pello-0.1.1

$ mv ~/pello.py /tmp/pello-0.1.1/

$ cp /tmp/LICENSE /tmp/pello-0.1.1/</code></pre>
</div>
</div>
</li>
<li>
<p>Создайте архив для распространения и переместите его вo <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf pello-0.1.1.tar.gz pello-0.1.1
pello-0.1.1/
pello-0.1.1/LICENSE
pello-0.1.1/pello.py

$ mv /tmp/pello-0.1.1.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="cello">cello</h4>
<div class="paragraph">
<p>Проект <em>cello</em> реализует <code>Hello World</code> на
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
. Реализация содержит только файлы <code>cello.c</code> и
<code>Makefile</code>, поэтому результирующий <code>tar.gz</code> архив будет содержать только два файла, кроме файла <code>LICENSE</code>. Давайте предположим, что это версия программы - <code>1.0</code></p>
</div>
<div class="paragraph">
<p>Обратите внимание, что <code>patch</code> не распространяется в архиве вместе с программой.
Упаковщик RPM применяет исправление при создании RPM. Патч будет помещен в каталог <code>~/rpmbuild/SOURCES/</code> рядом с <code>.tar.gz</code>.</p>
</div>
<div class="paragraph">
<p>Prepare the <em>cello</em> project for distribution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Поместите файлы в один каталог::</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mkdir /tmp/cello-1.0

$ mv ~/cello.c /tmp/cello-1.0/

$ mv ~/Makefile /tmp/cello-1.0/

$ cp /tmp/LICENSE /tmp/cello-1.0/</code></pre>
</div>
</div>
</li>
<li>
<p>Создайте архив для распространения и переместите его в  <code>~/rpmbuild/SOURCES/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /tmp/

$ tar -cvzf cello-1.0.tar.gz cello-1.0
cello-1.0/
cello-1.0/Makefile
cello-1.0/cello.c
cello-1.0/LICENSE

$ mv /tmp/cello-1.0.tar.gz ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
<li>
<p>Добавьте патч:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mv ~/cello-output-first-patch.patch ~/rpmbuild/SOURCES/</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь исходный код готов к упаковке в RPM.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="packaging-software">Программное обеспечение для упаковки</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этом руководстве объясняется, как упаковывать RPM для дистрибутивов Linux семейства Red Hat, в первую очередь:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://getfedora.org/">Fedora</a></p>
</li>
<li>
<p><a href="https://www.centos.org/">CentOS</a></p>
</li>
<li>
<p><a href="https://www.redhat.com/en/technologies/linux-platforms">Red Hat Enterprise Linux</a> (<a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Эти дистрибутивы используют формат упаковки <a href="http://rpm.org/">RPM</a>.</p>
</div>
<div class="paragraph">
<p>Хотя эти дистрибутивы являются целевой средой, данное руководство в основном применимо ко всем дистрибутивам, основанным на
<a href="https://en.wikipedia.org/wiki/List_of_Linux_distributions#RPM-based">RPM based</a>
.  Однако инструкции должны быть адаптированы для функций, специфичных для дистрибутива, таких как обязательные элементы установки, рекомендации или макросы.</p>
</div>
<div class="paragraph">
<p>В этом руководстве не предполагается никаких предварительных знаний об упаковке программного обеспечения для любой операционной системы, Linux или какой-либо другой.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Если вы не знаете, что такое программный пакет или дистрибутив GNU/Linux, рассмотрите возможность изучения некоторых статей на темы
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a> и
<a href="https://en.wikipedia.org/wiki/Package_manager">Package Managers</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="rpm-packages">RPM Пакеты</h3>
<div class="paragraph">
<p>В этом разделе рассматриваются основы формата упаковки RPM. Дополнительные сведения смотри в разделе
<a href="#advanced-topics">Дополнительные материалы</a>.</p>
</div>
<div class="sect3">
<h4 id="what-is-an-rpm">Что такое RPM?</h4>
<div class="paragraph">
<p>Пакет RPM - это просто файл, содержащий другие файлы и информацию о них, необходимую системе. В частности, пакет RPM состоит из архива
<a href="https://en.wikipedia.org/wiki/Cpio">cpio</a>
, который содержит файлы, и заголовка RPM, который содержит метаданные о пакете. Диспетчер пакетов <code>rpm</code> использует эти метаданные для определения зависимостей, места установки файлов и другой информации.</p>
</div>
<div class="paragraph">
<p>Существует два типа пакетов RPM:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>исходник RPM (SRPM)</p>
</li>
<li>
<p>бинарный RPM</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SRPMs и двоичные RPMs имеют общий формат файла и инструментарий, но имеют разное содержимое и служат разным целям. SRPM содержит исходный код, при необходимости исправления к нему и файл спецификации, в котором описывается, как встроить исходный код в двоичный RPM. Бинарный RPM содержит двоичные файлы, созданные из исходных текстов и патчей.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-packaging-tools">RPM Packaging Tools</h4>
<div class="paragraph">
<p>Пакет<code>rpmdevtools</code>, установленный на этпе <a href="#prerequisites">Необходимые пакеты</a>, provides предоставляет несколько утилит для упаковки RPM. Чтобы перечислить эти утилиты, запустите:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql rpmdevtools | grep bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для получения дополнительной информации о вышеуказанных утилитах см. их страницы руководства или диалоговые окна справки.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-packaging-workspace">Рабочее пространство для упаковки RPM</h4>
<div class="paragraph">
<p>Чтобы настроить макет каталога, который является рабочей областью упаковки RPM, используйте утилиту <code>rpmdev-setuptree</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmdev-setuptree

$ tree ~/rpmbuild/
/home/user/rpmbuild/
|-- BUILD
|-- RPMS
|-- SOURCES
|-- SPECS
`-- SRPMS`

5 directories, 0 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>Созданные каталоги служат следующим целям:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Каталог</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Назначение</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUILD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">При сборке пакетов здесь создаются различные каталоги     <code>%buildroot</code>. Это полезно для расследования неудачной сборки, если выходные данные журналов не содержат достаточной информации.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Двоичные RPM создаются здесь, в подкаталогах для разных архитектур, например, в подкаталогах<code>x86_64</code> и <code>noarch</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOURCES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Здесь упаковщик помещает сжатые архивы исходного кода и патчи. Команда <code>rpmbuild</code> ищет их здесь.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPECS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Упаковщик помещает сюда файлы спецификаций..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SRPMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Когда rpmbuild используется для построения SRPM вместо двоичного RPM, результирующий SRPM создается здесь.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="what-is-a-spec-file">Что такое SPEC файл?</h4>
<div class="paragraph">
<p>Файл спецификации можно рассматривать как "рецепт", который утилита <code>rpmbuild</code> использует для фактической сборки RPM. Он сообщает системе сборки, что делать, определяя инструкции в серии разделов. Разделы определены в <em>Преамбуле</em> и в <em>Основной части</em>. <em>Преамбула</em> содержит ряд элементов метаданных, которые используются в <em>Основной части</em>. Тело содержит основную часть инструкций.</p>
</div>
<div class="sect4">
<h5 id="preamble-items">Пункты преамбулы</h5>
<div class="paragraph">
<p>В этой таблице перечислены элементы, используемые в разделе преамбулы файла спецификации RPM:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEC Директива</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Определение</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Базовое имя пакета, которое должно совпадать с именем файла спецификации.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Версия upstream-кода.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Release</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Релиз пакета используется для указания номера сборки пакета при данной версии upstream-кода. Как правило, установите начальное значение равным 1%{?dist} и увеличивайте его с каждым новым выпуском пакета. Сбросьте значение до 1 при создании новой версии программного обеспечения.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Summary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Краткое, в одну строку, описание пакета.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>License</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Лицензия на упаковываемое программное обеспечение.
Fля пакетов, распространяемых в дистрибутивах сообщества, таких как <a href="https://getfedora.org/">Fedora</a>, это должна быть лицензия с открытым исходным кодом, соответствующая рекомендациям по лицензированию конкретного дистрибутива.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Полный URL-адрес для получения дополнительной информации о программе. Чаще всего это веб-сайт upstream-проекта для упаковываемого программного обеспечения.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Source0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Путь или URL-адрес к сжатому архиву исходного кода (не исправленный, исправления обрабатываются в другом месте). Этот раздел должен указывать на доступное и надежное хранилище архива, например, на upstream-страницу, а не на локальное хранилище упаковщика. При необходимости можно добавить дополнительные исходные директивы, каждый раз увеличивая их количество, например: Source1, Source2, Source3 и так далее.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Patch0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Название первого исправления, которое при необходимости будет применено к исходному коду. При необходимости можно добавить дополнительные директивы PatchX, увеличивая их количество каждый раз, например: Patch1, Patch2, Patch3 и так далее.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildArch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если пакет не зависит от архитектуры, например, если он полностью написан на интерпретируемом языке программирования, установите для этого значение <code>BuildArch: noarch</code>. Если этот параметр не задан, пакет автоматически наследует архитектуру компьютера, на котором он построен, например <code>x86_64</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildRequires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Разделенный запятыми или пробелами список пакетов, необходимых для сборки программы, написанной на скомпилированном языке. Может быть несколько записей <code>BuildRequires</code>, каждая в отдельной строке в файле спецификации.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Requires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Разделенный запятыми или пробелами список пакетов, необходимых программному обеспечению для запуска после установки. Может быть несколько записей <code>Requires</code>, каждая в отдельной строке в файле спецификации.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExcludeArch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если часть программного обеспечения не может работать на определенной архитектуре процессора, вы можете исключить эту архитектуру здесь.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Директивы <code>Name</code>, <code>Version</code> и <code>Release</code> содержат имя файла пакета RPM. Разработчики пакетов RPM и системные администраторы часто называют эти три директивы <strong>N-V-R</strong> или <strong>NVR</strong>, поскольку имена файлов пакетов RPM имеют формат <code>NAME-VERSION-RELEASE</code>.</p>
</div>
<div class="paragraph">
<p>Вы можете получить пример <code>NAME-VERSION-RELEASE</code>, выполнив запрос с использованием <code>rpm</code> для конкретного пакета:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -q python
python-2.7.5-34.el7.x86_64</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь <code>python</code> - это имя пакета, <code>2.7.5</code> - версия, а <code>34.el7</code> - релиз. Последний маркер <code>x86_64</code> - сведения об архитектуре.
В отличие от NVR, маркер архитектуры не находится под прямым управлением RPM упаковщика, а определяется средой сборки <code>rpmbuild</code>. Исключением из этого правила является архитектурно-независимый пакет <code>noarch</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="body-items">Составляющие основной части</h5>
<div class="paragraph">
<p>В этой таблице перечислены элементы, используемые в разделе Body (Тело, основная часть) файла спецификации RPM:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEC Директива</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Определение</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Полное описание программного обеспечения, входящего в комплект поставки RPM. Это описание может занимать несколько строк и может быть разбито на абзацы.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%prep</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Команда или серия команд для подготовки программного обеспечения к сборке, например, распаковка архива в Source0. Эта директива может содержать сценарий оболочки.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Команда или серия команд для фактической сборки программного обеспечения в машинный код (для скомпилированных языков) или байт-код (для некоторых интерпретируемых языков).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%install</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Команда или серия команд для копирования требуемых артефактов сборки из <code>%builddir</code> (где происходит сборка) в<code>%buildroot</code> каталог (который содержит структуру каталогов с файлами, подлежащими упаковке). Обычно это означает копирование файлов из <code>~/rpmbuild/BUILD</code> в <code>~/rpmbuild/BUILDROOT</code> и создание необходимых каталогов <code>~/rpmbuild/BUILDROOT</code>.  Это выполняется только при создании пакета, а не при установке пакета конечным пользователем. Подробности см в разделе <a href="#working-with-spec-files">Работа со SPEK файлом</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Команда или серия команд для тестирования программного обеспечения. Обычно это включает в себя такие вещи, как модульные тесты.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%files</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Список файлов, которые будут установлены в системе конечного пользователя.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%changelog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Запись изменений, произошедших с пакетом между различными <code>Version</code> или <code>Release</code> сборками.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="advanced-items">Дополнительные элементы</h5>
<div class="paragraph">
<p>Файл спецификации также может содержать дополнительные элементы. Например, файл спецификации может содержать <em>скриптлеты_ и </em>триггеры__. Они вступают в силу в разные моменты процесса установки в системе конечного пользователя (не в процессе сборки).</p>
</div>
<div class="paragraph">
<p>Дополнительную информацию см.  <a href="#triggers-and-scriptlets">Триггеры и скриптлеты</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="buildroots">BuildRoots</h4>
<div class="paragraph">
<p>В контексте упаковки RPM "buildroot" - это среда
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
Это означает, что артефакты сборки размещаются здесь с использованием той же иерархии файловой системы, что и в системе конечного пользователя, при этом "buildroot" выступает в качестве корневого каталога. Размещение артефактов сборки должно соответствовать стандарту иерархии файловой системы системы конечного пользователя.</p>
</div>
<div class="paragraph">
<p>Файлы в "buildroot" позже помещаются в архив
<a href="https://en.wikipedia.org/wiki/Cpio">cpio</a>
который становится основной частью RPM. Когда RPM устанавливается в системе конечного пользователя, эти файлы извлекаются в корневом каталоге, сохраняя правильную иерархию.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Начиная с выпуска Red Hat Enterprise Linux 6, программа <code>rpmbuild</code> меет свои собственные значения по умолчанию. Поскольку переопределение этих значений по умолчанию приводит к ряду проблем, Red Hat не рекомендует определять собственное значение этого макроса. Вы можете использовать макрос
<code>%{buildroot}</code>  с параметрами по умолчанию из каталога <code>rpmbuild</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="rpm-macros">RPM Макросы</h4>
<div class="paragraph">
<p><a href="https://rpm-software-management.github.io/rpm/manual/macros.html">Макрос RPM</a> - это прямая замена текста, которая может быть условно назначена на основе необязательной оценки оператора при использовании определенной встроенной функциональности. Это означает, что Вы можете заставить RPM выполнять замены текста за Вас.</p>
</div>
<div class="paragraph">
<p>Это полезно, например, при многократной ссылке на <em>Version</em> упакованного программного обеспечения в файле спецификации. Вы определяете <em>Version</em> только один раз - в макросе <code>%{version}</code>. Затем используйте <code>%{version}</code> во всем файле спецификации. Каждое вхождение будет автоматически заменено <em>Version</em> , которую вы определили ранее.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Если вы видите незнакомый макрос, вы можете узнать о нём с помощью:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{_MACRO}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{_bindir}
/usr/bin

$ rpm --eval %{_libexecdir}
/usr/libexec</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Распространенным макросом является <code>%{?dist}</code>, который обозначает “тег распространения”. Он сигнализирует, какой дистрибутив используется для сборки.</p>
</div>
<div class="paragraph">
<p>Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># On a RHEL 7.x machine
$ rpm --eval %{?dist}
.el7

# On a Fedora 23 machine
$ rpm --eval %{?dist}
.fc23</code></pre>
</div>
</div>
<div class="paragraph">
<p>Больше информации о макросах см. в разделе <a href="#more-on-macros">Подробнее о макросах</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="working-with-spec-files">Работа со SPEK файлами</h4>
<div class="paragraph">
<p>Большая часть упаковки программного обеспечения в RPMs - это редактирование файла спецификации. В этом разделе мы обсудим, как создать и изменить файл спецификации.</p>
</div>
<div class="paragraph">
<p>Чтобы упаковать новое программное обеспечение, вам необходимо создать новый файл спецификации. Вместо того, чтобы писать его вручную с нуля, используйте утилиту <code>rpmdev-newspec</code>. Он создает незаполненный файл спецификации, и Вы заполняете необходимые директивы и поля.</p>
</div>
<div class="paragraph">
<p>В этом руководстве мы используем три примера реализации программы 'Hello
World!' созданной при подготовке <a href="#preparing-software-for-packaging">программного обеспечения для упаковки</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/bello-0.1.tar.gz">bello-0.1.tar.gz</a></p>
</li>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/pello-0.1.1.tar.gz">pello-0.1.1.tar.gz</a></p>
</li>
<li>
<p><a href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/cello-1.0.tar.gz">cello-1.0.tar.gz</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://raw.githubusercontent.com/redhat-developer/rpm-packaging-guide/master/example-code/cello-output-first-patch.patch">cello-output-first-patch.patch</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Переместите их в <code>~/rpmbuild/SOURCES</code>.</p>
</div>
<div class="paragraph">
<p>Создайте SPEC файл для каждой из трёх программ:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Некоторые текстовые редакторы, ориентированные на программистов, предварительно заполняют новый <code>.spec</code> файл с их собственным шаблоном спецификации. <code>rpmdev-newspec</code> предоставляет независимый от редактора метод, именно поэтому он используется в этом руководстве..
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/rpmbuild/SPECS

$ rpmdev-newspec bello
bello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec cello
cello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec pello
pello.spec created; type minimal, rpm version &gt;= 4.11.</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>~/rpmbuild/SPECS/</code> каталог теперь имеет три SPEC файла с именами
<code>bello.spec</code>, <code>cello.spec</code>, и <code>pello.spec</code>.</p>
</div>
<div class="paragraph">
<p>Изучите файлы. Директивы в них представляют собой директивы, описанные в разделе
<a href="#what-is-a-spec-file">Что такое SPEK файл</a>.  В следующих разделах вы заполните эти файлы спецификаций.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Утилита <code>rpmdev-newspec</code> не использует рекомендации или соглашения, характерные для какого-либо конкретного дистрибутива Linux. Однако этот документ предназначен для Fedora, CentOS и RHEL, поэтому вы заметите, что:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Используйте <code>rm $RPM_BUILD_ROOT</code> при сборке на  <em>CentOS</em> (версии, предшествующие версии 7.0)
или на <a href="https://getfedora.org/">Fedora</a> (версии, предшествующие версии 18).</p>
</li>
<li>
<p>Мы предпочитаем использовать обозначение <code>%{buildroot}</code> вместо <code>$RPM_BUILD_ROOT</code> при обращении к Buildroot RPM для обеспечения согласованности со всеми другими определенными или предоставленными макросами во всем файле спецификации..</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ниже приведены три примера. Каждый из них полностью описан, так что вы можете перейти к конкретному, если он соответствует вашим потребностям в упаковке. Или прочтите их все, чтобы полностью изучить упаковку различных видов программного обеспечения.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Имя программы</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Объяснение примера</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Программа, написанная на необработанном интерпретируемом языке программирования. Пример демонстрирует, когда исходный код не нужно создавать, а нужно только установить. Если необходимо упаковать предварительно скомпилированный двоичный файл, вы также можете использовать этот метод, поскольку двоичный файл также будет просто файлом.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Программа, написанная на интерпретируемом языке программирования с байтовой компиляцией. Пример демонстрирует байтовую компиляцию исходного кода и установку байт-кода - результирующих, предварительно оптимизированных файлов.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Программа, написанная на изначально скомпилированном языке программирования. Пример демонстрирует общий процесс компиляции исходного кода в машинный код и установки результирующих исполняемых файлов.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="bello-working-with-spec-files">bello</h5>
<div class="paragraph">
<p>Первый SPEK файл предназначен для программы <code>bello</code> bash shell script from
<a href="#preparing-software-for-packaging">Подготовка программного обеспечения для упаковки</a>.</p>
</div>
<div class="paragraph">
<p>Убедитесь, что у вас есть:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Переместите исходный код <code>bello</code> в <code>~/rpmbuild/SOURCES/</code>.  См.
<a href="#working-with-spec-files">Работа со SPEC файлом</a>.</p>
</li>
<li>
<p>Теперь создайте пустой SPEC файл<code>~/rpmbuild/SPECS/bello.spec</code>. Файл будет иметь следующее содержание:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Теперь измените <code>~/rpmbuild/SPECS/bello.spec</code> для создания RPMs пакета  <code>bello</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Заполните поля<code>Name</code>, <code>Version</code>, <code>Release</code>, и <code>Summary</code> :</p>
<div class="ulist">
<ul>
<li>
<p>Поле <code>Name</code> уже было указано в качестве аргумента для  <code>rpmdev-newspec</code>.</p>
</li>
<li>
<p>Установите  <code>Version</code> в соответствии с “upstream” версией исходного кода <code>bello</code>, <code>0.1</code>.</p>
</li>
<li>
<p><code>Release</code> автоматически установит <code>1%{?dist}</code>, что изначально равно
<code>1</code>. Увеличивайте это значение при каждом обновлении пакета без изменения вышестоящей версии <code>Version</code> - например, при добавлениии патча.
Сбросьте <code>Release</code> до <code>1</code> когда произойдёт новый выпуск новой версии программы. Например, если будет выпущена bello версии <code>0.2</code>. Макрос <em>disttag</em> более подробно описан в части про
<a href="#rpm-macros">RPM Макросы</a>.</p>
</li>
<li>
<p><code>Summary</code> - это краткое, однострочное объяснение того, что представляет собой это программное обеспечение.</p>
<div class="paragraph">
<p>После Ваших изменений первый раздел SPEC файла примет следующий вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Заполните поля <code>License</code>, <code>URL</code>, и <code>Source0</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Поле <code>License</code> это
<a href="https://en.wikipedia.org/wiki/Software_license">Лицензия на программное обеспечение</a>
связанная с исходным кодом из upstream-выпуска.</p>
<div class="paragraph">
<p>Для корректного заполнения поля <code>License</code>, обратитесь к:
<a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora Руководство по лицензированию</a></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Например, используйте <code>GPLv3+</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Поле URL - это URL-адрес страницы upstream-программного обеспечения. для примера, используем
<code><a href="https://example.com/bello" class="bare">https://example.com/bello</a></code>. В данном поле рекомендуется использовать макрос %{name}, тогда адрес примет следующий вид: <code><a href="https://example.com/%{name}" class="bare">https://example.com/%{name}</a></code>.</p>
</li>
<li>
<p>Поле <code>Source0</code> fсодержит URL-адрес  upstream-исходного кода программного обеспечения. Он должен быть напрямую связан с версией программного обеспечения, которое упаковывается. В этом примере мы можем использовать <code><a href="https://example.com/bello/releases/bello-0.1.tar.gz" class="bare">https://example.com/bello/releases/bello-0.1.tar.gz</a></code>.
Используйте макросы %{name} и %{version} для учета изменений в версии. В результате адрес примет вид:
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code>.</p>
<div class="paragraph">
<p>После Ваших изменений первая секция SPEC файла примет вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Заполните директивы <code>BuildRequires</code> и <code>Requires</code> и подключите директиву <code>BuildArch</code>:</p>
<div class="paragraph">
<p>*
 <code>BuildRequires</code>  определяет зависимости для пакета во время сборки. Для <code>bello</code> нет этапа сборки, потому что bash - это необработанный интерпретируемый язык программирования, и файлы просто устанавливаются в их расположение в системе. Просто удалите эту директиву.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Requires</code> задает зависимости для пакета во время выполнения, то-есть, необходимые пакеты для работы программы.   Для выполнения скрипта <code>bello</code>
требуется только оболочка  <code>bash</code>, поэтому укажите bash в этой директиве.</p>
</li>
<li>
<p>Поскольку это программное обеспечение, написанное на интерпретируемом языке программирования без изначально скомпилированных расширений, добавьте директиву <code>BuildArch</code> со значением<code>noarch</code>. Это говорит RPM о том, что этот пакет не нужно привязывать к архитектуре процессора, на которой он построен.</p>
<div class="paragraph">
<p>После Ваших изменений первая секция SPEC файла примет вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

Requires:       bash

BuildArch:      noarch</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Заполните поля <code>%description</code>, <code>%prep</code>, <code>%build</code>, <code>%install</code>,
<code>%files</code>, and <code>%license</code>. Эти директивы являются заголовками секций, поскольку они определяют многостроковые, скриптовые или состоящие из нескольких инструкций задачи.</p>
<div class="ulist">
<ul>
<li>
<p><code>%description</code> это более длинное и полное описание программного обеспечения, чем <code>Summary</code>, содержащее один или несколько абзацев. В нашем примере мы будем использовать только краткое описание.</p>
</li>
<li>
<p>В разделе <code>%prep</code> Обычно это включает в себя расширение сжатых архивов исходного кода, применение исправлений и, возможно, анализ информации, предоставленной в исходном коде, для использования в следующей части SPEC файла. В этом разделе мы просто используем встроенный макрос <code>%setup -q</code>.</p>
</li>
<li>
<p>Секция <code>%build</code> определяет, как на самом деле создавать программное обеспечение, которое мы упаковываем. Однако, поскольку <code>bash</code> не нужно создавать, просто удалите то, что было предоставлено шаблоном, и оставьте этот раздел пустым.</p>
</li>
<li>
<p>Секция <code>%install</code> содержит инструкции для <code>rpmbuild</code>  о том, как установить программное обеспечение после его сборки в каталог <code>BUILDROOT</code>.
Этот каталог представляет собой пустой базовый каталог
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
,который напоминает корневой каталог конечного пользователя. Здесь мы должны создать любые каталоги, которые будут содержать установленные файлы.</p>
<div class="paragraph">
<p>Поскольку для установки <code>bello</code> нам нужно только создать каталог назначения и установить туда исполняемый файл <code>bash</code> скрипт мы будем использовать команду  <code>install</code>. Макросы RPM позволяют нам делать это без жесткого кодирования путей.</p>
</div>
<div class="paragraph">
<p>Секция <code>%install</code> после ваших изменений должен выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install

mkdir -p %{buildroot}/%{_bindir}

install -m 0755 %{name} %{buildroot}/%{_bindir}/%{name}</code></pre>
</div>
</div>
</li>
<li>
<p>В секци <code>%files</code> указывается список файлов, предоставляемых этим RPM, и их полный путь в системе конечного пользователя. Следовательно, путь устанавливаемого файла <code>bello</code> - это <code>/usr/bin/bello</code>, или, с помощью макросов RPM,
<code>%{_bindir}/%{name}</code>.</p>
<div class="paragraph">
<p>В этом разделе вы можете указать роль различных файлов с помощью встроенных макросов. Это полезно для запроса метаданных манифеста файла пакета с помощью команд
<code>rpm</code>. Например, чтобы указать, что файл  LICENSE является файлом лицензии на программное обеспечение, мы используем макрос %license.</p>
</div>
<div class="paragraph">
<p>После изменения, секция<code>%files</code> примет следующий вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%{_bindir}/%{name}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Последняя секция, <code>%changelog</code>, представляет собой список записей с отметкой даты для каждой версии-выпуска пакета. Они регистрируют изменения упаковки, а не изменения программного обеспечения. Примеры изменений упаковки: добавление исправления, изменение процедуры сборки в <code>%build</code>.</p>
<div class="paragraph">
<p>Следуйте следующему формату для первой строки:</p>
</div>
<div class="paragraph">
<p><code>* Day-of-Week Month Day Year Name Surname &lt;email&gt; - Version-Release</code></p>
</div>
<div class="paragraph">
<p>Следуйте данным правилам для фактической записи изменений:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Каждая запись об изменении может содержать несколько элементов - по одному для каждого изменения</p>
</li>
<li>
<p>Каждый элемент начинается с новой строки.</p>
</li>
<li>
<p>Каждый элемент начинается с символа <code>-</code>. .</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Пример записи с отметкой даты</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Вы написали целый файл спецификации <strong>bello</strong>. Послный SPEC файл <strong>bello</strong> теперь выглядит так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in
bash script.

%prep
%setup -q

%build

%install

mkdir -p %{buildroot}/%{_bindir}

install -m 0755 %{name} %{buildroot}/%{_bindir}/%{name}

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>В следующем разделе рассказывается о том, как создать RPM.</p>
</div>
</div>
<div class="sect4">
<h5 id="pello-working-with-spec-files">pello</h5>
<div class="paragraph">
<p>Наш второй SPEC будет для примера, написанного на языке программирования the <a href="https://www.python.org/">Python</a>
который вы скачали (или вы создали имитированный upstream- выпуск в разделе <a href="#preparing-software-for-packaging">Подготовка программного обеспечения</a>) и разместили его исходный код в <code>~/rpmbuild/SOURCES/</code>. Давайте продолжим и откроем файл  <code>~/rpmbuild/SPECS/pello.spec</code>  начнем заполнять некоторые поля.</p>
</div>
<div class="paragraph">
<p>Прежде чем мы начнем идти по этому пути, нам нужно рассмотреть кое-что несколько уникальное в интерпретируемом программном обеспечении с байт-компиляцией. Поскольку использовать байт-компиляцию,
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
больше не применим, поскольку результирующий файл не будет содержать запись. Обычной практикой является либо наличие небайтового скомпилированного сценария оболочки, который будет вызывать исполняемый файл, либо наличие небольшого фрагмента кода
<a href="https://www.python.org/">Python</a> , который не скомпилирован в байтах, в качестве “точки входа” в выполнение программы. Это может показаться глупым для нашего небольшого примера, но для больших программных проектов со многими тысячами строк кода увеличение производительности при предварительной байт-компиляции кода является значительным.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Создание скрипта для вызова байт-скомпилированного кода или наличие небайт-скомпилированной точки входа в программное обеспечение - это то, к чему разработчики upstream программного обеспечения чаще всего обращаются перед выпуском своего программного обеспечения в мир, однако это не всегда так, и это упражнение призвано помочь решить, что делать в таких ситуациях. Для получения дополнительной информации о том, как обычно выпускается и распространяется код
<a href="https://www.python.org/">Python</a>, пожалуйста, обратитесь к следующей документации: <a href="https://docs.python.org/2/library/distribution.html">Упаковка и распространение программного обеспечения</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Мы создадим небольшой сценарий оболочки для вызова нашего байт-скомпилированного кода, который станет точкой входа в наше программное обеспечение. Мы сделаем это как часть самого нашего файла спецификации, чтобы продемонстрировать, как вы можете создавать сценарии действий внутри SPEC файла. Мы рассмотрим эти особенности позже в разделе <code>%install</code>.</p>
</div>
<div class="paragraph">
<p>Давайте продолжим и откроем файл  <code>~/rpmbuild/SPECS/pello.spec</code>  и начнем заполнять некоторые поля.</p>
</div>
<div class="paragraph">
<p>Ниже приведен шаблон вывода, который мы получили из<code>rpmdev-newspec</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как и в первом примере, давайте начнем с первого набора директив, которые <code>rpmdev-newspec</code>сгруппировал в верхней части файла: <code>Name</code>,
<code>Version</code>, <code>Release</code>, <code>Summary</code>. Поле <code>Name</code> уже заполнено, так как мы передали его в командной строке при использовании команды <code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Давайте установим  <code>Version</code> соответствующую версии “upstream” релиза исходного кода
<em>pello</em> , которая, как мы видим, равна <code>0.1.1</code>, как указано в примире кода, который мы загрузили (или создали в разделе
<a href="#preparing-software-for-packaging">Подготовка программного обеспечения</a> section).</p>
</div>
<div class="paragraph">
<p>В поле <code>Release</code> уже установлено значение <code>1%{?dist}</code> которое изначально равно <code>1</code>, и должно увеличиваться каждый раз, когда пакет обновляется по какой-либо причине, например, включает новый патч для устранения проблемы, но не имеет новой версии upstream-выпуска. Когда происходит новый upstream-выпуск (например, была выпущена версия pello <code>0.1.2</code>) тогда <code>Release</code> должен быть сброшен до значения <code>1</code>. <em>disttag</em><code>%{?dist}</code> выглядит знакоммо по описанию макросов из <a href="#rpm-macros">RPM Макросы</a> в предыдущем разделе.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>``Summary`` должно представлять собой краткое, в одну строку, объяснение того, что представляет собой это программное обеспечение.</pre>
</div>
</div>
<div class="paragraph">
<p>После Ваших изменений первый раздел SPEC файла примет следующий вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь давайте перейдем ко второму набору директив, которые <code>rpmdev-newspec</code> сгруппировал вместе в нашем SPEC файле: <code>License</code>, <code>URL</code>, <code>Source0</code>.</p>
</div>
<div class="paragraph">
<p>Поле <code>License</code> это
<a href="https://en.wikipedia.org/wiki/Software_license">Лицензия на программное обеспечение</a> связанная с исходным кодом из upstream выпуска.  Точный формат обозначения лицензии в вашем файле  SPEC будет варьироваться в зависимости от того, каким конкретным рекомендациям по дистрибутиву
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a>, использующим RPM, вы следуете. Мы будем использовать стандарты обозначения из
<a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora Руководство по лицензированию</a>, поэтому это поле будет содержать лицензию <code>GPLv3+</code></p>
</div>
<div class="paragraph">
<p>Поле <code>URL</code> - это веб-сайт upstream программного обеспечения. Это не ссылка на скачивание исходного кода, а фактический веб-сайт проекта, продукта или компании, где кто-то может найти больше информации об этой конкретной части программного обеспечения. Поскольку это просто пример, мы будем использовать адрес. <code><a href="https://example.com/pello" class="bare">https://example.com/pello</a></code>. Однако, мы применим макрос RPM  <code>%{name}</code> для корректности оформления.</p>
</div>
<div class="paragraph">
<p>Поле <code>Source0</code> это место, откуда должен быть загружен upstrem исходный код программного обеспечения. Этот URL-адрес должен содержать прямую ссылку на конкретную версию выпуска исходного кода, которую мы упаковываем. Еще раз, поскольку это пример, мы будем использовать ссылку на следующий архив:
<code><a href="https://example.com/pello/releases/pello-0.1.1.tar.gz" class="bare">https://example.com/pello/releases/pello-0.1.1.tar.gz</a></code></p>
</div>
<div class="paragraph">
<p>Мы должны отметить, что в этом примере URL-адреса есть жестко закодированные значения, которые можно изменить в будущем и потенциально они даже могут измениться, например, версия выпуска <code>0.1.1</code>. Мы можем упростить это, если потребуется обновить только одно поле в SPEC файле и разрешить его повторное использование.
Мы будем использовать макросы
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code>, вместо ссылок из примеров раннее.</p>
</div>
<div class="paragraph">
<p>После ваших изменений верхняя часть вашего SPEC файла должна выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>У нас есть секции <code>BuildRequires</code> и <code>Requires</code>, каждый из которых определяет что-то, что требуется для пакета. Однако , <code>BuildRequires</code> должен сообщать
<code>rpmbuild</code> о том, что необходимо вашему пакету во время <strong>сборки</strong>, а<code>Requires</code> - это то, что необходимо вашему пакету во время <strong>установки</strong>.</p>
</div>
<div class="paragraph">
<p>В этом примере нам понадобится пакет <code>python</code> для выполнения процесса сборки с байт-компиляцией.  Этот пакет понадобится во время выполнения байт-скомпилированного кода, поэтому нам необходимо определить <code>python</code> как требуемый пакет в директиве <code>Requires</code>. Нам также понадобится пакет <code>bash</code> для выполнения небольшого сценария точки входа, который мы будем использовать здесь.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Поскольку эта программа написана на интерпритируемом языке программирования без изначально скомпилированных расширений, нужно добавить секцию ``BuildArch``. В ней задано значение noarch, чтобы сообщить RPM, что этот пакет не нужно привязывать к архитектуре процессора, на которой он построен.</pre>
</div>
</div>
<div class="paragraph">
<p>После ваших изменений верхняя часть вашего SPEC файла должна выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

BuildRequires:  python
Requires:       python
Requires:       bash

BuildArch:      noarch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующие директивы можно рассматривать как “заголовки разделов”, поскольку они являются директивами, которые могут определять многостроковые, скриптовые или состоящие из нескольких инструкций задачи. Мы пройдемся по ним один за другим, как и по предыдущим пунктам.</p>
</div>
<div class="paragraph">
<p>Секция %description - это более длинное и полное описание программного обеспечения, чем <code>Summary</code>, содержащее один или несколько абзацев. В нашем примере мы будем использовать только краткое описание. В нашем примере это секция не будет содержать глубокое описание, но при желании этот раздел может быть целым абзацем или более.</p>
</div>
<div class="paragraph">
<p>Секция <code>%prep</code> это место, где мы <em>подготавливаем</em> нашу среду сборки или рабочее пространство для сборки. Чаще всего здесь происходит расширение сжатых архивов исходного кода, применение исправлений и, возможно, анализ информации, предоставленной в исходном коде, которая необходима в следующей части  SPEC файла. IВ этом разделе мы просто будем использовать предоставленный макрос <code>%setup -q</code>.</p>
</div>
<div class="paragraph">
<p>Секция <code>%build</code>- это раздел, где мы рассказываем системе, как на самом деле создавать программное обеспечение, которое мы упаковываем. Здесь мы выполним байтовую компиляцию нашего программного обеспечения. Для тех, кто читал раздел <a href="#preparing-software-for-packaging">Подготовка программного обеспечения</a>, эта часть примера должна показаться знакомой.</p>
</div>
<div class="paragraph">
<p>Секчия <code>%build</code> нашего SPEC файла должна выглядеть следующим образом.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%build

python -m compileall pello.py</code></pre>
</div>
</div>
<div class="paragraph">
<p>Секция <code>%install</code> это раздел, отвечающий за инструктирование <code>rpmbuild</code>, как установить наше ранее созданное программное обеспечение в <code>BUILDROOT</code> который фактически является базовым каталогом
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
в котором ничего нет, и нам нужно будет создать любые пути или иерархии каталогов, которые нам понадобятся, чтобы установить наше программное обеспечение здесь в их определенных местах. Однако наши макросы RPM помогают нам выполнить эту задачу без необходимости жестко кодировать пути.</p>
</div>
<div class="paragraph">
<p>Ранее мы обсуждали, что, поскольку мы потеряем контекст файла со строкой
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
в нем при байт-компиляции, нам нужно будет создать простой сценарий-оболочку для выполнения этой задачи.  Есть много вариантов того, как это сделать, включая, но не ограничиваясь этим, создание отдельного скрипта и использование его в качестве отдельной директивы <code>SourceX</code>, а также вариант, который мы собираемся показать в этом примере, который заключается в создании файла в строке в SPEC файле. Причина, по которой мы показываем примерный вариант, заключается в том, чтобы просто продемонстрировать, что сам файл спецификации доступен для сценариев. Что мы собираемся сделать, так это создать небольшой “сценарий-оболочку”, который будет выполнять байт-скомпилированный код
<a href="https://www.python.org/">Python</a> используя
<a href="https://en.wikipedia.org/wiki/Here_document">here document</a>
. Нам также нужно будет фактически установить
байт-скомпилированный файл в каталог библиотеки в системе, чтобы к нему можно было получить доступ.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Ниже вы заметите, что мы жестко кодируем путь к библиотеке. Существуют различные методы, позволяющие избежать необходимости делать это, многие из которых рассматриваются в
<a href="#дополнительных разделах">[дополнительных разделах]</a>, в разделе <a href="#more-on-macros">Подрбнее о макросах</a>, и специфичны для языка программирования, на котором было написано упаковываемое программное обеспечение. В этом примере мы жестко закодировали путь для простоты, чтобы не охватывать слишком много тем одновременно.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Секция <code>%install</code> после Ваших изменений должна выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install

mkdir -p %{buildroot}/%{_bindir}
mkdir -p %{buildroot}/usr/lib/%{name}

cat &gt; %{buildroot}/%{_bindir}/%{name} &lt;&lt;-EOF
#!/bin/bash
/usr/bin/python /usr/lib/%{name}/%{name}.pyc
EOF

chmod 0755 %{buildroot}/%{_bindir}/%{name}

install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Секция <code>%files</code> это место, где мы предоставляем список файлов, которые предоставляет этот RPM, и где они должны находиться в системе, на которую установлен RPM. Обратите внимание, что это относится не к <code>%{buildroot}</code> а к полному пути к файлам, поскольку ожидается, что они будут существовать в конечной системе после установки. Таким образом, список устанавливаемого файла <code>pello</code>  будет <code>%{_bindir}/pello</code>.  Нам также нужно будет предоставить список <code>%dir</code>, чтобы определить, что этот пакет “владеет” каталогом библиотеки, который мы создали, а также всеми файлами, которые мы разместили в нем.</p>
</div>
<div class="paragraph">
<p>Кроме того, в этом разделе вам иногда понадобится встроенный макрос для предоставления контекста для файла. Это может быть полезно для системных администраторов и конечных пользователей, которые могут захотеть запросить систему с помощью <code>rpm</code> о конечном пакете. Встроенный макрос, который мы будем использовать здесь, - это <code>%license</code>, который сообщит <code>rpmbuild</code>, что это файл лицензии на программное обеспечение в метаданных манифеста файла пакета.</p>
</div>
<div class="paragraph">
<p>Секция <code>%files</code> после Ваших изменений должен выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%dir /usr/lib/%{name}/
%{_bindir}/%{name}
/usr/lib/%{name}/%{name}.py*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Последняя секция, <code>%changelog</code>, представляет собой список записей с отметками о дате, которые соотносятся с конкретной версией-выпуском пакета. Это не журнал изменений в программном обеспечении от выпуска к выпуску, а конкретно изменения в упаковке. Например, если программное обеспечение в пакете нуждалось в исправлении или было необходимо внести изменения в процедуру сборки, указанную в секции<code>%build</code>, эта информация будет размещена здесь. Каждая запись изменения может содержать несколько элементов, и каждый элемент должен начинаться с новой строки и начинаться с символа <code>-</code>.
Ниже приведен наш пример записи:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1.1-1
- First pello package
- Example second item in the changelog for version-release 0.1.1-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание на приведенный выше формат, отметка даты будет начинаться с символа <code>*</code>, за которым следует календарный день недели, месяц, день месяца, год, затем контактная информация для упаковщика RPM. Оттуда у нас есть символ<code>-</code> перед выпуском версии, что является часто используемым, но не строго регламентированным. Затем, наконец, Версия-Релиз.</p>
</div>
<div class="paragraph">
<p>Вот и все! Мы написали целый файл спецификаций для <strong>pello</strong>! В следующем разделе мы расскажем, как создать RPM!</p>
</div>
<div class="paragraph">
<p>Полный файл спецификации теперь должен выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in python

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

BuildRequires:  python
Requires:       python
Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in
Python.

%prep
%setup -q

%build

python -m compileall %{name}.py

%install

mkdir -p %{buildroot}/%{_bindir}
mkdir -p %{buildroot}/usr/lib/%{name}

cat &gt; %{buildroot}/%{_bindir}/%{name} &lt;&lt;-EOF
#!/bin/bash
/usr/bin/python /usr/lib/%{name}/%{name}.pyc
EOF

chmod 0755 %{buildroot}/%{_bindir}/%{name}

install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/

%files
%license LICENSE
%dir /usr/lib/%{name}/
%{_bindir}/%{name}
/usr/lib/%{name}/%{name}.py*

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1.1-1
  - First pello package</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cello-working-with-spec-files">cello</h5>
<div class="paragraph">
<p>Наш третий SPEC файл будет для нашего примера на языке
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
, для которого мы ранее создали имитированную версию upstream (или вы скачали) и разместили его исходный код в <code>~/rpmbuild/SOURCES/</code> ранее.</p>
</div>
<div class="paragraph">
<p>Давайте откроем файл <code>~/rpmbuild/SPECS/cello.spec</code> и начнём заполнять некоторые поля.</p>
</div>
<div class="paragraph">
<p>Ниже приведен шаблон вывода, который мы получили от  <code>rpmdev-newspec</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:
Release:        1%{?dist}
Summary:

License:
URL:
Source0:

BuildRequires:
Requires:

%description

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT
%make_install

%files
%doc

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt;
-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как и в предыдущих примерах, давайте начнем с первого набора директив, которые <code>rpmdev-newspec</code> сгруппировал в верхней части файла:
<code>Name</code>, <code>Version</code>, <code>Release</code>, <code>Summary</code>. The <code>Name</code> уже указано, потому что мы предоставили эту информацию в командной строке для <code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Давайте установим в поле <code>Version</code> значение, соответствующее “upstream” версии исходного кода
<em>cello</em>, которая, как мы видим, равна <code>1.0</code>, как указано в примере кода, который мы загрузили (или создали в секции <a href="#preparing-software-for-packaging">Подготовка программного обеспечения</a>).</p>
</div>
<div class="paragraph">
<p>В <code>Release</code> уже установлено значение <code>1%{?dist}</code>  числовое значение, которое изначально равно <code>1</code>, должно увеличиваться каждый раз, когда пакет обновляется по какой-либо причине, например, включает новый патч для устранения проблемы, но не имеет новой версии upstream выпуска. Когда происходит новый upstream выпуск  (например, была выпущена версия cello <code>2.0</code>), тогда значение <code>Release</code> должно быть сброшено до<code>1</code>.  <em>disttag</em><code>%{?dist}</code> выглядит знакоммо по описанию макросов из <a href="#rpm-macros">RPM Макросы</a> в предыдущем разделе.</p>
</div>
<div class="paragraph">
<p><code>Summary</code> должно представлять собой краткое, в одну строку, объяснение того, что представляет собой это программное обеспечение.</p>
</div>
<div class="paragraph">
<p>После ваших изменений первый раздел SPEC файла должен выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь давайте перейдем ко второму набору директив, которые <code>rpmdev-newspec</code> сгруппировал вместе в нашем SPEC файле: <code>License</code>, <code>URL</code>, <code>Source0</code>. Однако, мы добавим одну директиву в эту группу, поскольку она тесно связана с <code>Source0</code> , и это наш  <code>Patch0</code> в котором будет указан первый патч, который нам нужен для нашего программного обеспечения.</p>
</div>
<div class="paragraph">
<p>Поле <code>License</code> это
<a href="https://en.wikipedia.org/wiki/Software_license">Лицензия на программное обеспечение</a> связанная с исходным кодом из upstream выпуска.  Точный формат обозначения лицензии в вашем файле  SPEC будет варьироваться в зависимости от того, каким конкретным рекомендациям по дистрибутиву
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a>, использующим RPM, вы следуете. Мы будем использовать стандарты обозначения из
<a href="https://fedoraproject.org/wiki/Licensing:Main">Fedora Руководство по лицензированию</a>, поэтому это поле будет содержать лицензию <code>GPLv3+</code></p>
</div>
<div class="paragraph">
<p>Поле <code>URL</code> - это веб-сайт upstream программного обеспечения. Это не ссылка на скачивание исходного кода, а фактический веб-сайт проекта, продукта или компании, где кто-то может найти больше информации об этой конкретной части программного обеспечения. Поскольку это просто пример, мы будем использовать адрес. <code><a href="https://example.com/сello" class="bare">https://example.com/сello</a></code>. Однако, мы применим макрос RPM  <code>%{name}</code> для корректности оформления.</p>
</div>
<div class="paragraph">
<p>Поле <code>Source0</code> это место, откуда должен быть загружен upstrem исходный код программного обеспечения. Этот URL-адрес должен содержать прямую ссылку на конкретную версию выпуска исходного кода, которую мы упаковываем. Еще раз, поскольку это пример, мы будем использовать ссылку на следующий архив:
<code><a href="https://example.com/cello/releases/cello-1.0.tar.gz" class="bare">https://example.com/cello/releases/cello-1.0.tar.gz</a></code></p>
</div>
<div class="paragraph">
<p>Мы должны отметить, что в этом примере URL-адреса есть жестко закодированные значения, которые можно изменить в будущем и потенциально они даже могут измениться, например, версия выпуска <code>1.0</code>. Мы можем упростить это, если потребуется обновить только одно поле в SPEC файле и разрешить его повторное использование.
Мы будем использовать макросы
<code><a href="https://example.com/%{name}/releases/%{name}-%{version}.tar.gz" class="bare">https://example.com/%{name}/releases/%{name}-%{version}.tar.gz</a></code>, вместо ссылок из примеров раннее.</p>
</div>
<div class="paragraph">
<p>Следующий пункт - предоставить список для файла <code>.patch</code> который мы создали ранее, чтобы мы могли применить его к коду позже в секции<code>%prep</code>. Нам понадобится список  <code>Patch0: cello-output-first-patch.patch</code>.</p>
</div>
<div class="paragraph">
<p>После ваших изменений верхняя часть вашего SPEC файла должна выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

Patch0:         cello-output-first-patch.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>У нас есть секции <code>BuildRequires</code> и <code>Requires</code>, каждый из которых определяет что-то, что требуется для пакета. Однако , <code>BuildRequires</code> должен сообщать
<code>rpmbuild</code> о том, что необходимо вашему пакету во время <strong>сборки</strong>, а<code>Requires</code> - это то, что необходимо вашему пакету во время <strong>установки</strong>.</p>
</div>
<div class="paragraph">
<p>В этом примере нам понадобятся пакеты <code>gcc</code> и <code>make</code> для выполнения процесса сборки компиляции. Требования времени выполнения, к счастью, обрабатываются для нас <code>rpmbuild</code> потому что эта программа не требует ничего за пределами основных стандартных библиотек
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
, и поэтому нам не нужно будет определять что-либо вручную в качестве <code>Requires</code> , и мы можем опустить эту директиву.</p>
</div>
<div class="paragraph">
<p>После Ваших изменений верхняя часть SPEC Вашего файла должна выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://example.com/%{name}
Source0:        https://example.com/%{name}/release/%{name}-%{version}.tar.gz

BuildRequires:  gcc
BuildRequires:  make</code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующие директивы являются заголовками секций, поскольку они определяют многостроковые, скриптовые или состоящие из нескольких инструкций задачи. Мы пройдемся по ним один за другим, как и по предыдущим пунктам.</p>
</div>
<div class="paragraph">
<p>Секция <code>%description</code> это более длинное и полное описание программного обеспечения, чем <code>Summary</code>, содержащее один или несколько абзацев. В нашем примере мы будем использовать только краткое описание. В нашем примере это секция не будет содержать глубокое описание, но при желании этот раздел может быть целым абзацем или более.</p>
</div>
<div class="paragraph">
<p>Секция <code>%prep</code> это место, где мы <em>подготавливаем</em> нашу среду сборки или рабочее пространство для сборки. Чаще всего здесь происходит расширение сжатых архивов исходного кода, применение исправлений и, возможно, анализ информации, предоставленной в исходном коде, которая необходима в следующей части  SPEC файла. IВ этом разделе мы просто будем использовать предоставленный макрос <code>%setup -q</code>.</p>
</div>
<div class="paragraph">
<p>Секция <code>%build</code> это то, где мы рассказываем системе, как на самом деле создавать программное обеспечение, которое мы упаковываем. Поскольку мы написали простой  <code>Makefile</code> для нашей реализации на
<a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>
, мы можем просто использовать команду <a href="http://www.gnu.org/software/make/">GNU make</a>, предоставленную
<code>rpmdev-newspec</code>. Однако нам нужно удалить вызов, <code>%configure</code>, поскольку мы не предоставили
<a href="https://en.wikipedia.org/wiki/Configure_script">configure script</a>
. Секция <code>%build</code> нашего SPEC должен выглядеть следующим образом.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%build
make %{?_smp_mflags}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Секция <code>%install</code>  это то, где мы инструктируем <code>rpmbuild</code> как установить наше ранее созданное программное обеспечение в <code>BUILDROOT</code> wкоторый фактически является базовым каталогом
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a>
в котором ничего нет, и нам нужно будет создать любые пути или иерархии каталогов, которые нам понадобятся, чтобы установить наше программное обеспечение здесь в их определенных местах. Однако наши макросы RPM помогают нам выполнить эту задачу без необходимости жестко кодировать пути.</p>
</div>
<div class="paragraph">
<p>Еще раз, поскольку у нас есть простой  <code>Makefile</code> , шаг установки можно легко выполнить, оставив на месте макрос <code>%make_install</code> , который снова был предоставлен нам командой <code>rpmdev-newspec</code>.</p>
</div>
<div class="paragraph">
<p>Секция <code>%install</code> после Ваших изменений должна принять следующий вид:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%install
%make_install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Секция <code>%files</code>  это место, где мы предоставляем список файлов, которые предоставляет этот RPM, и где они должны находиться в системе, на которую установлен RPM. Обратите внимание, что это относится не к <code>%{buildroot}</code>, а к полному пути к файлам, поскольку ожидается, что они будут существовать в конечной системе после установки. Таким образом путь устанавливаемого файла <code>cello</code> будет <code>%{_bindir}/cello</code>.</p>
</div>
<div class="paragraph">
<p>Кроме того, в этом разделе вам иногда понадобится встроенный макрос для предоставления контекста для файла. Это может быть полезно для системных администраторов и конечных пользователей, которые могут захотеть запросить систему с помощью <code>rpm</code> о конечном пакете. Встроенный макрос, который мы будем использовать здесь, - это <code>%license</code>, который сообщит <code>rpmbuild</code>, что это файл лицензии на программное обеспечение в метаданных манифеста файла пакета.</p>
</div>
<div class="paragraph">
<p>Секция <code>%files</code> после Ваших изменений должна выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%files
%license LICENSE
%{_bindir}/%{name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Последняя секция, <code>%changelog</code>, представляет собой список записей с отметками о дате, которые соотносятся с конкретной версией-выпуском пакета. Это не журнал изменений в программном обеспечении от выпуска к выпуску, а конкретно изменения в упаковке. Например, если программное обеспечение в пакете нуждалось в исправлении или было необходимо внести изменения в процедуру сборки, указанную в секции<code>%build</code>, эта информация будет размещена здесь. Каждая запись изменения может содержать несколько элементов, и каждый элемент должен начинаться с новой строки и начинаться с символа <code>-</code>.
Ниже приведен наш пример записи:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 0.1-1
- First cello package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание на приведенный выше формат, отметка даты будет начинаться с символа <code>*</code>, за которым следует календарный день недели, месяц, день месяца, год, затем контактная информация для упаковщика RPM. Оттуда у нас есть символ<code>-</code> перед выпуском версии, что является часто используемым, но не строго регламентированным. Затем, наконец, Версия-Релиз.</p>
</div>
<div class="paragraph">
<p>Вот и все! Мы написали целый файл спецификаций для <strong>cello</strong>! В следующем разделе мы расскажем, как создать RPM!</p>
</div>
<div class="paragraph">
<p>Полный файл спецификации теперь должен выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            https://www.example.com/%{name}
Source0:        https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz

Patch0:         cello-output-first-patch.patch

BuildRequires:  gcc
BuildRequires:  make

%description
The long-tail description for our Hello World Example implemented in
C.

%prep
%setup -q

%patch0

%build
make %{?_smp_mflags}

%install
%make_install

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;maxamillion@fedoraproject.org&gt; - 1.0-1
- First cello package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Пакет <code>rpmdevtools</code> предоставляет набор шаблонов файлов спецификаций для нескольких популярных языков в каталоге<code>/etc/rpmdevtools/</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-rpms">Создание RPMS</h3>
<div class="paragraph">
<p>RPMs создаются с помощью команды  <code>rpmbuild</code>. Различные сценарии и желаемые результаты требуют различных комбинаций аргументов для <code>rpmbuild</code>. В этом разделе описываются два основных сценария:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>создание исходного RPM</p>
</li>
<li>
<p>создание бинарного RPM</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Команда <code>rpmbuild</code> ожидает определенную структуру каталогов и файлов.  Это та же структура, что и в утилите <code>rpmdev-setuptree</code>. Предыдущие инструкции также подтвердили требуемую структуру.</p>
</div>
<div class="sect3">
<h4 id="source-rpms">Исходный RPMs</h4>
<div class="paragraph">
<p>Зачем создавать исходный RPM (SRPM)?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Чтобы сохранить точный источник определенного Name-Version-Release RPM, который был развернут в среде.  Это включает в себя точный SPEC файл, исходный код и все соответствующие исправления. Это полезно для просмотра истории и для отладки.</p>
</li>
<li>
<p>Чтобы иметь возможность создавать двоичный RPM на другой аппаратной платформе или
<a href="https://en.wikipedia.org/wiki/Microarchitecture">архитектуре</a>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="create-source-rpms">Для создания SRPM:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bs _SPECFILE_</code></pre>
</div>
</div>
<div class="paragraph">
<p>Замените <em>SPECFILE</em> SPEC файлом. Параметр  <code>-bs</code> "исходный код сборки".</p>
</div>
<div class="paragraph">
<p>Здесь мы создаем SRPMs для <code>bello</code>, <code>pello</code> и <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd ~/rpmbuild/SPECS/

$ rpmbuild -bs bello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm

$ rpmbuild -bs pello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm

$ rpmbuild -bs cello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание, что SRPMS были помещены в каталог  <code>rpmbuild/SRPMS</code> directory, который является частью структуры, ожидаемой <code>rpmbuild</code>.</p>
</div>
<div class="paragraph">
<p>Это все, что нужно для создания SRPM.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="binary-rpms">Бинарный RPMS</h4>
<div class="paragraph">
<p>Существует два метода построения бинарных RPMs:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Восстановление его из SRPM с использованием комманды<code>rpmbuild --rebuild</code>.</p>
</li>
<li>
<p>Строим его из файла спецификации с помощью команды <code>rpmbuild -bb</code>. Опция  <code>-bb</code> означает "построить двоичный файл" (<code>build binary</code>).</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="rebuild">Восстановление из исходного RPM</h5>
<div class="paragraph">
<p>Чтобы перестроить <code>bello</code>, <code>pello</code> и <code>cello</code> из исходных RPM (SRPMs), запустите:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
[output truncated]

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
[output truncated]

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
[output truncated]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь вы создали RPM. Несколько заметок:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Выходные данные, генерируемые при создании бинарного RPM, являются подробными, что полезно для отладки. Выходные данные различаются для разных примеров и соответствуют их SPEC файлам.</p>
</li>
<li>
<p>Конечные бинарные RPM находятся в   <code>~/rpmbuild/RPMS/YOURARCH</code> где <code>YOURARCH</code> - это ваша
<a href="https://en.wikipedia.org/wiki/Microarchitecture">архитектура</a>
или в
<code>~/rpmbuild/RPMS/noarch/</code> если пакет не зависит от архитектуры.</p>
</li>
<li>
<p>Вызов <code>rpmbuild --rebuild</code> включает в себя:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Установка содержимого RPM - файла спецификации и исходного кода - в <code>~/rpmbuild/</code> directory.</p>
</li>
<li>
<p>Построение с использованием установленного содержимого.</p>
</li>
<li>
<p>Удаление файла спецификации и исходного кода..</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Вы можете сохранить файл спецификации и исходный код после сборки. Для этого у вас есть два варианта:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>При сборке используйте опцию  <code>--recompile</code> вместо <code>--rebuild</code>.</p>
</li>
<li>
<p>Установите SRPMS с помощью следующих команд:</p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -Uvh ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
Updating / installing...
   1:bello-0.1-1.el7                  ################################# [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
Updating / installing...
   1:pello-0.1.1-1.el7                ################################# [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Updating / installing...
   1:cello-1.0-1.el7                  ################################# [100%]</code></pre>
</div>
</div>
<div class="paragraph">
<p>В этом руководстве выполните приведенные выше команды <code>rpm -Uvh</code> чтобы продолжить взаимодействие с файлами спецификаций и исходными кодами.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="build-binary">Создание бинарного файла из SPEC файла</h5>
<div class="paragraph">
<p>Чтобы создать <code>bello</code>, <code>pello</code>, and <code>cello</code> из их SPEC файлов, запустите:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -bb ~/rpmbuild/SPECS/bello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/pello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/cello.spec</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь вы создали RPM из SPEC файлов.</p>
</div>
<div class="paragraph">
<p>Большая часть информации, содержащейся в разделе in <a href="#rebuild">Восстановление из исходного RPM</a> применима здесь.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="checking-rpms-for-sanity">Проверка RPMs на корректность</h3>
<div class="paragraph">
<p>После создания упаковки хорошо бы проверить ее качество. Качество пакета, а не программного обеспечения, поставляемого в нем. Основным инструментом для этого является
<a href="https://github.com/rpm-software-management/rpmlint">rpmlint</a>. Это улучшает редактируемость RPM и обеспечивает проверку работоспособности и ошибок путем выполнения статического анализа  RPM. Эта утилита может проверять двоичные RPM, исходные RPM (SRPMs) и spec файлы, поэтому она полезна на всех этапах упаковки, как показано в следующих примерах.</p>
</div>
<div class="paragraph">
<p>Обратите внимание, что <code>rpmlint</code> имеет очень строгие правила, и иногда допустимо и необходимо пропустить некоторые из его ошибок и предупреждений, как показано в следующих примерах.
examples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
В примерах мы запускаем <code>rpmlint</code> без каких-либо опций, что приводит к невербальному выводу. Для получения подробных объяснений каждой ошибки или предупреждения вместо этого запустите
<code>rpmlint -i</code> instead.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="checking-bello-spec-file">Проверка SPEC файла bello</h4>
<div class="paragraph">
<p>Это результат выполнения  <code>rpmlint</code> в SPEC файле <code>bello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint bello.spec
bello.spec: W: invalid-url Source0: https://www.example.com/bello/releases/bello-0.1.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для <code>bello.spec</code> есть только одно предупреждение. В нем говорится, что URL-адрес, указанный в директиве
<code>Source0</code> недоступен. Это ожидаемо, поскольку указанный <code>example.com</code> URL-адрес не существует. Предполагая, что мы ожидаем, что этот URL-адрес будет работать в будущем, мы можем проигнорировать это предупреждение</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Это результат выполнения <code>rpmlint</code> на SRPM для <code>bello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm
bello.src: W: invalid-url URL: https://www.example.com/bello HTTP Error 404: Not Found
bello.src: W: invalid-url Source0: https://www.example.com/bello/releases/bello-0.1.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для <code>bello</code> SRPM появилось новое предупреждение, в котором говорится, что URL-адрес, указанный в директиве URL, недоступен. Предполагая, что ссылка будет работать в будущем, мы можем проигнорировать это предупреждение..</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="checking-bello-binary-rpm">Проверка бинарного RPM bello</h4>
<div class="paragraph">
<p>При проверке бинарных RPMs, <code>rpmlint</code> проверяет дополнительные параметры, в том числе:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>документацию</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Man_page">страницы руководства</a></p>
</li>
<li>
<p>корректность  <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Иерархии файловой системы</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Это результат выполнения<code>rpmlint</code> на бинарном RPM для <code>bello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/noarch/bello-0.1-1.el7.noarch.rpm
bello.noarch: W: invalid-url URL: https://www.example.com/bello HTTP Error 404: Not Found
bello.noarch: W: no-documentation
bello.noarch: W: no-manual-page-for-binary bello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>no-documentation</code> и<code>no-manual-page-for-binary</code> оворят о том, что в RPM нет документации или страниц руководства, потому что мы их не предоставили.
Apart from the above warnings, our RPM is passing <code>rpmlint</code> checks.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="checking-pello-spec-file">Проверка SPEC файла pello</h4>
<div class="paragraph">
<p>Это результат выполнения <code>rpmlint</code> в файле спецификации для <code>pello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint pello.spec
pello.spec:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.spec:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.spec:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.spec:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.spec:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.spec: W: invalid-url Source0: https://www.example.com/pello/releases/pello-0.1.1.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 5 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Предупреждение <code>invalid-url Source0</code> wговорит о том, что URL-адрес, указанный в директиве Source0 - недоступен. Это ожидаемо, поскольку указанный example.com URL-адрес не существует. Предполагая, что мы ожидаем, что этот URL-адрес будет работать в будущем, мы можем проигнорировать это предупреждение.</p>
</li>
<li>
<p>Ошибок много, потому что мы намеренно написали этот файл спецификации, чтобы он был простым и показывал, о каких ошибках может сообщать <code>rpmlint</code>.</p>
</li>
<li>
<p>Ошибки <code>hardcoded-library-path</code> предполагают использование макроса  <code>%{_libdir}</code> вместо жесткого кодирования пути к библиотеке. Ради этого примера мы игнорируем эти ошибки, но для пакетов, запущенных в производство, вам нужна веская причина для игнорирования этой ошибки.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Это результат выполнения <code>rpmlint</code> на SRPM для <code>pello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/pello-0.1.1-1.el7.src.rpm
pello.src: W: invalid-url URL: https://www.example.com/pello HTTP Error 404: Not Found
pello.src:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.src:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.src:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.src:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.src:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.src: W: invalid-url Source0: https://www.example.com/pello/releases/pello-0.1.1.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 5 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Новая ошибка<code>invalid-url URL</code> здесь связана с директивой <code>URL</code> которая недоступна.  Предполагая, что мы ожидаем, что URL-адрес станет действительным в будущем, мы можем игнорировать эту ошибку.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="checking-pello-binary-rpm">Проверка бинарного RPM pello</h4>
<div class="paragraph">
<p>При проверке бинарного RPMs, <code>rpmlint</code> проверяет дополнительные параметры, в том числе:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>документацию</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Man_page">страницы руководства</a></p>
</li>
<li>
<p>последовательное использование</p>
</li>
<li>
<p>корректность  <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Иерархии файловой системы</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Это результат выполнения <code>rpmlint</code> на бинарном RPM для <code>pello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/noarch/pello-0.1.1-1.el7.noarch.rpm
pello.noarch: W: invalid-url URL: https://www.example.com/pello HTTP Error 404: Not Found
pello.noarch: W: only-non-binary-in-usr-lib
pello.noarch: W: no-documentation
pello.noarch: E: non-executable-script /usr/lib/pello/pello.py 0644L /usr/bin/env
pello.noarch: W: no-manual-page-for-binary pello
1 packages and 0 specfiles checked; 1 errors, 4 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Предупреждения  <code>no-documentation</code> и <code>no-manual-page-for-binary</code> говорят о том, что в RPM нет документации или страниц руководства, потому что мы их не предоставили.</p>
</li>
<li>
<p>Предупреждение  <code>only-non-binary-in-usr-lib</code> гласит, что вы предоставили только бинарные артефакты  <code>/usr/lib/</code>. Этот каталог обычно зарезервирован для общих объектных файлов, которые являются бинарными файлами. Следовательно, <code>rpmlint</code> eожидает, что по крайней мере один или несколько файлов в <code>/usr/lib/</code> будут бинарными.</p>
<div class="paragraph">
<p>Это пример проверки <code>rpmlint</code> на соответствие
<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Иерархии Файловой Системы</a>
.</p>
</div>
<div class="paragraph">
<p>Обычно для обеспечения правильного размещения файлов используются макросы RPM. Ради этого примера мы можем проигнорировать это предупреждение.</p>
</div>
</li>
<li>
<p>Ошибка <code>non-executable-script</code> предупреждает о том, что <code>/usr/lib/pello/pello.py</code>
файл не имеет прав на выполнение. Поскольку этот файл содержит
<a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>
, <code>rpmlint</code> ожидает, что файл будет исполняемым. Для целей примера оставьте этот файл без разрешений на выполнение и проигнорируйте эту ошибку.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Помимо вышеприведенных предупреждений и ошибок, наш RPM проходит проверку <code>rpmlint</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="checking-cello-spec-file">Проверка SPEC файла cello</h4>
<div class="paragraph">
<p>Это результат выполнения <code>rpmlint</code> в SPEC файле <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SPECS/cello.spec
/home/admiller/rpmbuild/SPECS/cello.spec: W: invalid-url Source0: https://www.example.com/cello/releases/cello-1.0.tar.gz HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Единственное предупреждение для <code>cello.spec</code> гласит, что URL-адрес, указанный в директиве
<code>Source0</code>, недоступен. Это ожидаемо, поскольку указанный <code>example.com</code> URL-адрес не существует. Предполагая, что мы ожидаем, что этот URL-адрес будет работать в будущем, мы можем проигнорировать это предупреждение.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Это результат выполнения <code>rpmlint</code> в файле SRPM для <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
cello.src: W: invalid-url URL: https://www.example.com/cello HTTP Error 404: Not Found
cello.src: W: invalid-url Source0: https://www.example.com/cello/releases/cello-1.0.tar.gz HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для <code>cello</code> SRPM появилось новое предупреждение, в котором говорится, что URL-адрес, указанный в директиве <code>URL</code>, недоступен.  Предполагая, что ссылка будет работать в будущем, мы можем проигнорировать это предупреждение.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="checking-cello-binary-rpm">Проверка бинарного RPM cello</h4>
<div class="paragraph">
<p>При проверке бинарных RPMs, <code>rpmlint</code> проверяет дополнительные параметры, в том числе:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>документацию</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Man_page">страницы руководства</a></p>
</li>
<li>
<p>корректность  <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Иерархии файловой системы</a>
.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Это результат выполнения <code>rpmlint</code> на бинарном RPM для <code>cello</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmlint ~/rpmbuild/RPMS/x86_64/cello-1.0-1.el7.x86_64.rpm
cello.x86_64: W: invalid-url URL: https://www.example.com/cello HTTP Error 404: Not Found
cello.x86_64: W: no-documentation
cello.x86_64: W: no-manual-page-for-binary cello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Наблюдения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Предупреждения <code>no-documentation</code> и <code>no-manual-page-for-binary</code> говорят о том, что в RPM нет документации или страниц руководства, потому что мы их не предоставили.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Помимо вышеприведенных предупреждений и ошибок, наш RPM проходит проверку <code>rpmlint</code>.</p>
</div>
<div class="paragraph">
<p>Наши RPM теперь готовы и проверены с помощью <code>rpmlint</code>. На этом учебное пособие заканчивается. Для получения дополнительной информации о RPM упаковке перейдите к главе
<a href="#advanced-topics">Дополнительные материалы</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-topics">Дополнительные материалы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В этой главе рассматриваются темы, которые выходят за рамки вводного руководства, но часто полезны в реальной упаковке RPM.</p>
</div>
<div class="sect2">
<h3 id="Signing-Packages">Подпись пакетов</h3>
<div class="paragraph">
<p>Подпись пакета - это способ защитить пакет для конечного пользователя. Безопасная транспортировка может быть достигнута с помощью реализации протокола HTTPS, что может быть сделано, когда пакет загружается непосредственно перед установкой. Однако пакеты часто загружаются заранее и хранятся в локальных репозиториях перед их использованием. Пакеты подписываются, чтобы гарантировать, что никакая третья сторона не сможет изменить содержимое пакета.</p>
</div>
<div class="paragraph">
<p>Существует три способа подписи пакета:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Adding-a-Signature-to-a-Package">Добавление подписи к уже существующему пакету</a>.</p>
</li>
<li>
<p><a href="#Replacing-a-Package-Signature">Замена подписи на уже существующем пакете</a>.</p>
</li>
<li>
<p><a href="#Build-time-Signing">
Подпись пакета во время сборки</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="Adding-a-Signature-to-a-Package">Добавление подписи к пакету</h4>
<div class="paragraph">
<p>В большинстве случаев пакеты создаются без подписи. Подпись добавляется непосредственно перед выпуском пакета.</p>
</div>
<div class="paragraph">
<p>Чтобы добавить другую подпись к пакету package, используйте опцию <code>--addsign</code>. Наличие более чем одной подписи позволяет зафиксировать путь владения пакетом от разработчика пакета до конечного пользователя.</p>
</div>
<div class="paragraph">
<p>В качестве примера подразделение компании создает пакет и подписывает его ключом подразделения. Затем штаб-квартира компании проверяет подпись пакета и добавляет корпоративную подпись к пакету, заявляя, что подписанный пакет является подлинным.</p>
</div>
<div class="paragraph">
<p>С двумя подписями пакеи попадает к продавцу. Продавец проверяет подписи и, если они проверяются, также добавляет свою подпись.</p>
</div>
<div class="paragraph">
<p>Теперь пакет отправляется в компанию, которая желает его развернуть. Проверив каждую подпись на упаковке, они знают, что это подлинная копия, не изменившаяся с момента ее первого создания. В зависимости от внутреннего контроля внедряющей компании, они могут добавить свою собственную подпись, чтобы заверить своих сотрудников в том, что пакет получил их корпоративное одобрение.</p>
</div>
<div class="paragraph">
<p>Вывод из команды <code>--addsign</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --addsign blather-7.9-1.i386.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для проверки подписей пакета с несколькими подписями:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp pgp md5 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Два обозначения <code>pgp</code> в выходных данных команды <code>rpm --checksig</code> показывают, что пакет был подписан дважды.</p>
</div>
<div class="paragraph">
<p>RPM позволяет добавлять одну и ту же подпись несколько раз. Параметр <code>--addsign</code>
не проверяет наличие нескольких идентичных подписей.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --addsig blather-7.9-1.i386.rpm
              Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp pgp pgp pgp md5 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>На выходе команды <code>rpm --checksig</code> отображается четыре подписи.</p>
</div>
</div>
<div class="sect3">
<h4 id="Replacing-a-Package-Signature">Замена подписи пакета</h4>
<div class="paragraph">
<p>Чтобы изменить открытый ключ без необходимости пересобирать каждый пакет, используйте опцию <code>--resign</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --resign blather-7.9-1.i386.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Использование опции <code>--resign</code> с несколькими пакетами:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --resign b*.rpm
            Enter pass phrase:

Pass phrase is good.
blather-7.9-1.i386.rpm:
bother-3.5-1.i386.rpm:</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Build-time-Signing">Подпись во время сборки</h4>
<div class="paragraph">
<p>Чтобы подписать пакет во время сборки, используйте команду <code>rpmbuild</code> с параметром <code>--sign</code>. Для этого необходимо ввести кодовую фразу PGP.</p>
</div>
<div class="paragraph">
<p>Для примера:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -ba --sign blather-7.9.spec
            Enter pass phrase:

Pass phrase is good.
* Package: blather
…
Binary Packaging: blather-7.9-1
Finding dependencies...
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm
…
Source Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Сообщение "Generating signature" появляется как в двоичном, так и в исходном разделах упаковки. Число, следующее за сообщением, указывает на то, что добавленная подпись была создана с использованием  PGP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>При использовании опции <code>--sign</code> в <code>rpmbuild</code>, используйте только аргументы <code>-bb</code> или <code>-ba</code> для сборки пакета. Аргумент <code>-ba</code> обозначает сборку бинарных <strong>и</strong> исходных пакетов.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Чтобы проверить подпись пакета, используйте <code>rpm</code> комманду <code>--checksig</code>. Для примера:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --checksig blather-7.9-1.i386.rpm
blather-7.9-1.i386.rpm: size pgp md5 OK</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="Building-Multiple-Packages">Сборка нескольких пакетов</h5>
<div class="paragraph">
<p>При создании нескольких пакетов используйте следующий синтаксис, чтобы избежать многократного ввода кодовой фразы
PGP. Например, при сборки пакетов <code>blather</code> и <code>bother</code>, подпишите их, следуя примеру ниже:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild -ba --sign b*.spec
              Enter pass phrase:

Pass phrase is good.
* Package: blather
…
Binary Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm
…
Source Packaging: blather-7.9-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm
…
* Package: bother
…
Binary Packaging: bother-3.5-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/RPMS/i386/bother-3.5-1.i386.rpm
…
Source Packaging: bother-3.5-1
…
Generating signature: 1002
Wrote: /usr/src/redhat/SRPMS/bother-3.5-1.src.rpm</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mock">Mock</h3>
<div class="paragraph">
<p><a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> - это инструмент для создания пакетов. Он может создавать пакеты для разных архитектур и разных версий Fedora или RHEL. Mock создает chroots и собирает в них пакеты. Его единственная задача - надежно заполнить chroot и попытаться создать пакет в этом chroot.</p>
</div>
<div class="paragraph">
<p>Mock также предлагает многопакетный инструмент <code>mockchain</code>, который может создавать цепочки пакетов, зависящих друг от друга.</p>
</div>
<div class="paragraph">
<p>Mock способен создавать Rpm из управления конфигурацией исходного кода, если присутствует пакет
<code>mock-scm</code> а затем встраивать SRPM в RPMs. Смотрите –scm-enable
в документации. (Из upstream документации)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Чтобы использовать <a href="https://github.com/rpm-software-management/mock/wiki">Mock</a>
 в системе RHEL или CentOS, вам необходимо включить репозиторий “Extra Packages for
Enterprise Linux” (<a href="https://fedoraproject.org/wiki/EPEL">EPEL</a>) . Это репозиторий, предоставляемый сообществом <a href="https://getfedora.org/">Fedora</a>, содержит множество полезных инструментов для пакетов RPM, системных администраторов и разработчиков.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Одним из наиболее распространенных вариантов для RPM-упаковщиков использования
<a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> , является создание так называемой “нетронутой среды сборки”. При использовании mock в качестве “нетронутой среды сборки” ничто в текущем состоянии вашей системы не влияет на сам пакет RPM.  Mock использует различные конфигурации, чтобы указать, какова “цель” сборки, они находятся в вашей системе в каталоге<code>/etc/mock/</code> (после установки пакета <code>mock</code>). Вы можете выполнить сборку для разных дистрибутивов или выпусков, просто указав это в командной строке. Следует иметь в виду, что файлы конфигурации, поставляемые с макетом, предназначены для упаковщиков Fedora RPM, и поэтому выпускные версии RHEL и CentOS помечены как “epel” , потому что это «целевой» репозиторий, для которого эти RPM будут созданы. Вы просто указываете конфигурацию, которую хотите использовать (без расширения файла <code>.cfg</code>). Например, вы можете создать наш пример <code>cello</code> как для RHEL 7, так и для Fedora 23, используя следующие команды, даже не используя разные машины.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mock -r epel-7-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm

$ mock -r fedora-23-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Один из примеров того, почему вы можете захотеть использовать <code>mock</code> - это если вы упаковывали RPMs на своем ноутбуке, и у вас был установлен пакет (в этом примере мы назовем его <code>foo</code>), который был <code>BuildRequires</code> того пакета, который вы создавали, но забыли фактически сделать запись <code>BuildRequires: foo</code>. Сборка завершится успешно, когда вы запустите<code>rpmbuild</code> потому что<code>foo</code> был необходим для сборки, и он был найден в системе во время сборки. Однако, если вы перенесете SRPM в другую систему, в которой отсутствовал <code>foo</code>, он выйдет из строя, что вызовет неожиданный побочный эффект.
<a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> решает эту проблему, сначала анализируя содержимое  SRPM и устанавливая <code>BuildRequires</code> в его
<a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> , что означает, что если бы вам не хватало записи  <code>BuildRequires</code> , сборка завершилась бы с ошибкой, потому что <code>mock</code> не знал бы, как её установить, и поэтому она не присутствовала бы в buildroot.</p>
</div>
<div class="paragraph">
<p>Другой пример - противоположный сценарий, допустим, вам нужен <code>gcc</code> для сборки пакета, но он не установлен в вашей системе (что маловероятно для RPM-упаковщика, но просто ради примера давайте притворимся, что это правда).
С <a href="https://github.com/rpm-software-management/mock/wiki">Mock</a>, Вам не нужно устранавливать <code>gcc</code>в вашей системе, потому что он будет установлен в chroot как часть процесса <code>mock</code>.</p>
</div>
<div class="paragraph">
<p>Ниже приведен пример попытки перестроить пакет, у которого есть зависимость, которой мне не хватает в моей системе. Главное, что следует отметить, это то, что, хотя <code>gcc</code> обычно используется в большинстве систем  RPM упаковщиками, некоторые пакеты RPM могут содержать более дюжины сборочных запросов, и это позволяет вам не загромождать свою рабочую станцию ненужными или ненужными пакетами.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
Installing /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
error: Failed build dependencies: gcc is needed by cello-1.0-1.el7.x86_64

$ mock -r epel-7-x86_64 ~/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm
INFO: mock.py version 1.2.17 starting (python version = 2.7.5)...
Start: init plugins
INFO: selinux enabled
Finish: init plugins
Start: run
INFO: Start(/home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm)  Config(epel-7-x86_64)
Start: clean chroot
Finish: clean chroot
Start: chroot init
INFO: calling preinit hooks
INFO: enabled root cache
Start: unpacking root cache
Finish: unpacking root cache
INFO: enabled yum cache
Start: cleaning yum metadata
Finish: cleaning yum metadata
Mock Version: 1.2.17
INFO: Mock Version: 1.2.17
Start: yum update
base                                                                    | 3.6 kB  00:00:00
epel                                                                    | 4.3 kB  00:00:00
extras                                                                  | 3.4 kB  00:00:00
updates                                                                 | 3.4 kB  00:00:00
No packages marked for update
Finish: yum update
Finish: chroot init
Start: build phase for cello-1.0-1.el7.src.rpm
Start: build setup for cello-1.0-1.el7.src.rpm
warning: Could not canonicalize hostname: rhel7
Building target platforms: x86_64
Building for target x86_64
Wrote: /builddir/build/SRPMS/cello-1.0-1.el7.centos.src.rpm
Getting requirements for cello-1.0-1.el7.centos.src
 --&gt; Already installed : gcc-4.8.5-4.el7.x86_64
 --&gt; Already installed : 1:make-3.82-21.el7.x86_64
No uninstalled build requires
Finish: build setup for cello-1.0-1.el7.src.rpm
Start: rpmbuild cello-1.0-1.el7.src.rpm
Building target platforms: x86_64
Building for target x86_64
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.v9rPOF
+ umask 022
+ cd /builddir/build/BUILD
+ cd /builddir/build/BUILD
+ rm -rf cello-1.0
+ /usr/bin/gzip -dc /builddir/build/SOURCES/cello-1.0.tar.gz
+ /usr/bin/tar -xf -
+ STATUS=0
+ '[' 0 -ne 0 ']'
+ cd cello-1.0
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
Patch #0 (cello-output-first-patch.patch):
+ echo 'Patch #0 (cello-output-first-patch.patch):'
+ /usr/bin/cat /builddir/build/SOURCES/cello-output-first-patch.patch
patching file cello.c
+ /usr/bin/patch -p0 --fuzz=0
+ exit 0
Executing(%build): /bin/sh -e /var/tmp/rpm-tmp.UxRVtI
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ make -j2
gcc -g -o cello cello.c
+ exit 0
Executing(%install): /bin/sh -e /var/tmp/rpm-tmp.K3i2dL
+ umask 022
+ cd /builddir/build/BUILD
+ '[' /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64 '!=' / ']'
+ rm -rf /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
++ dirname /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ mkdir -p /builddir/build/BUILDROOT
+ mkdir /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ cd cello-1.0
+ /usr/bin/make install DESTDIR=/builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
mkdir -p /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin
install -m 0755 cello /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin/cello
+ /usr/lib/rpm/find-debuginfo.sh --strict-build-id -m --run-dwz --dwz-low-mem-die-limit 10000000 --dwz-max-die-limit 110000000 /builddir/build/BUILD/cello-1.0
extracting debug info from /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/bin/cello
dwz: Too few files for multifile optimization
/usr/lib/rpm/sepdebugcrcfix: Updated 0 CRC32s, 1 CRC32s did match.
+ /usr/lib/rpm/check-buildroot
+ /usr/lib/rpm/redhat/brp-compress
+ /usr/lib/rpm/redhat/brp-strip-static-archive /usr/bin/strip
+ /usr/lib/rpm/brp-python-bytecompile /usr/bin/python 1
+ /usr/lib/rpm/redhat/brp-python-hardlink
+ /usr/lib/rpm/redhat/brp-java-repack-jars
Processing files: cello-1.0-1.el7.centos.x86_64
Executing(%license): /bin/sh -e /var/tmp/rpm-tmp.vxtAuO
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ LICENSEDIR=/builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ export LICENSEDIR
+ /usr/bin/mkdir -p /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ cp -pr LICENSE /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64/usr/share/licenses/cello-1.0
+ exit 0
Provides: cello = 1.0-1.el7.centos cello(x86-64) = 1.0-1.el7.centos
Requires(rpmlib): rpmlib(CompressedFileNames) &lt;= 3.0.4-1 rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
Requires: libc.so.6()(64bit) libc.so.6(GLIBC_2.2.5)(64bit) rtld(GNU_HASH)
Processing files: cello-debuginfo-1.0-1.el7.centos.x86_64
Provides: cello-debuginfo = 1.0-1.el7.centos cello-debuginfo(x86-64) = 1.0-1.el7.centos
Requires(rpmlib): rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1 rpmlib(CompressedFileNames) &lt;= 3.0.4-1
Checking for unpackaged file(s): /usr/lib/rpm/check-files /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
Wrote: /builddir/build/RPMS/cello-1.0-1.el7.centos.x86_64.rpm
warning: Could not canonicalize hostname: rhel7
Wrote: /builddir/build/RPMS/cello-debuginfo-1.0-1.el7.centos.x86_64.rpm
Executing(%clean): /bin/sh -e /var/tmp/rpm-tmp.JuPOtY
+ umask 022
+ cd /builddir/build/BUILD
+ cd cello-1.0
+ /usr/bin/rm -rf /builddir/build/BUILDROOT/cello-1.0-1.el7.centos.x86_64
+ exit 0
Finish: rpmbuild cello-1.0-1.el7.src.rpm
Finish: build phase for cello-1.0-1.el7.src.rpm
INFO: Done(/home/admiller/rpmbuild/SRPMS/cello-1.0-1.el7.src.rpm) Config(epel-7-x86_64) 0 minutes 16 seconds
INFO: Results and/or logs in: /var/lib/mock/epel-7-x86_64/result
Finish: run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как Вы можете видеть, <code>mock</code> - довольно подробный инструмент. Вы также заметите много выходных данных
<a href="http://yum.baseurl.org/">yum</a> или
<a href="https://github.com/rpm-software-management/dnf">dnf</a> output (в зависимости от фиктивной цели RHEL7, CentOS7 или Fedora), которых нет в этом выводе, который был опущен для краткости и часто опускается после того, как вы выполнили <code>--init</code> для mock target. Например  <code>mock -r epel-7-x86_64 --init</code> который предварительно загрузит все необходимые пакеты, закэширует их и запустит предварительный этап сборкиchroot.</p>
</div>
<div class="paragraph">
<p>Для получения дополнительной информации, пожалуйста, обратитесь к
<a href="https://github.com/rpm-software-management/mock/wiki">Mock</a> upstream
документации.</p>
</div>
</div>
<div class="sect2">
<h3 id="version-control-systems">Система контроля версий</h3>
<div class="paragraph">
<p>При работе с RPMs,желательно использовать
<a href="https://en.wikipedia.org/wiki/Version_control">Системы контроля версий</a> (VCS) такую как <a href="https://git-scm.com/">git</a> Следует отметить, что хранение двоичных файлов в системе контроля версий нецелесообразно, поскольку это резко увеличивает размер исходного репозитория, поскольку эти инструменты разработаны для обработки различий в файлах (часто оптимизированных для текстовых файлов) и это не то, чему поддаются бинарные файлы, поэтому обычно сохраняется весь бинарные файл целиком. В качестве побочного эффекта этого есть некоторые умные утилиты, популярные среди вышестоящих проектов с открытым исходным кодом, которые решают эту проблему, либо сохраняя файл SPEC, где исходный код находится в VCS (т. е. - он не находится в сжатом архиве для распространения ) или поместите в VCS только SPEC-файл и патчи и загрузите сжатый архив updtream исходного кода  в так называемый «кэш просмотра».</p>
</div>
<div class="paragraph">
<p>В этом разделе мы рассмотрим два различных варианта использования системы контроля версий
<a href="https://git-scm.com/">git</a>, для управления содержимым, которое в конечном итоге будет преобразовано в пакет RPM. Первый называется <a href="https://github.com/dgoodwin/tito">tito</a>,
второй - <a href="https://github.com/release-engineering/dist-git">dist-git</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Вам нужно будет установить пакет <code>git</code> в Вашу систему, он понадобится нам для изучения данного раздела.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tito">tito</h4>
<div class="ulist">
<ul>
<li>
<p>это утилита, которая предполагает, что весь исходный код программного обеспечения, которое будет упаковано, уже находится в репозитории <a href="https://git-scm.com/">git</a>.  Это хорошо для тех, кто практикует рабочий процесс DevOps, поскольку позволяет команде, пишущей программное обеспечение, поддерживать свой нормальный
<a href="https://git-scm.com/book/en/v2/Git-Branching-Branching-Workflows">абочий процесс ветвления</a>. Затем Tito позволит поэтапно упаковывать программное обеспечение, создавать его в автоматическом режиме и по-прежнему обеспечивать собственный процесс установки для системы на основе RPM <a href="http://rpm.org/">RPM</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Пакет <a href="https://github.com/dgoodwin/tito">tito</a> доступен в
<a href="https://getfedora.org/">Fedora</a>, а также в репозитории
<a href="https://fedoraproject.org/wiki/EPEL">EPEL</a> для использования на RHEL 7 и CentOS 7.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tito работает на основе тегов <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">git tags</a> и будет управлять тегами для вас, если вы решите разрешить это, но при желании может работать по любой схеме тегов, которую вы предпочитаете, поскольку эта функциональность настраивается.</p>
</div>
<div class="paragraph">
<p>Давайте немного познакомимся с tito, взглянув на исходный проект, который уже использует его. На самом деле мы будем использовать исходный репозиторий git проекта, который является предметом нашего следующего раздела,
<a href="https://github.com/release-engineering/dist-git">dist-git</a>. Поскольку этот проект публично размещен на
 <a href="https://github.com/">GitHub</a>, давайте клонируем репозиторий git.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git clone https://github.com/release-engineering/dist-git.git
Cloning into 'dist-git'...
remote: Counting objects: 425, done.
remote: Total 425 (delta 0), reused 0 (delta 0), pack-reused 425
Receiving objects: 100% (425/425), 268.76 KiB | 0 bytes/s, done.
Resolving deltas: 100% (184/184), done.
Checking connectivity... done.

$ cd dist-git/

$ ls *.spec
dist-git.spec

$ tree rel-eng/
rel-eng/
├── packages
│   └── dist-git
└── tito.props

1 directory, 2 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как мы видим, файл спецификации находится в корне репозитория git, и в репозитории есть каталог <code>rel-eng</code>, который используется tito для общего учета, настройки и различных дополнительных тем, таких как пользовательские модули tito. В макете каталога мы видим, что есть подкаталог с названием <code>packages</code>, в котором будет храниться файл для каждого пакета, которым tito управляет в репозитории, поскольку у вас может быть много RPM в одном репозитории git, и tito справится с этим просто отлично. Однако в этом сценарии мы видим только один список пакетов, и следует отметить, что он соответствует имени нашего файла спецификации. Все это настраивается командой <code>tito init</code> when the developers of
<a href="https://github.com/release-engineering/dist-git">dist-git</a>, когда разработчики dist-git впервые инициализировали свое репозиторий git для управления tito.</p>
</div>
<div class="paragraph">
<p>Если бы мы следовали обычному рабочему процессу DevOps Practitioner, мы, вероятно, хотели бы использовать его как часть процесса
<a href="https://en.wikipedia.org/wiki/Continuous_integration">Непрерывной интеграции</a>
(CI) или <a href="https://en.wikipedia.org/wiki/Continuous_delivery">Непрерывной доставки</a>
(CD). Что мы можем сделать в этом сценарии, так это выполнить то, что известно как
“test build” для tito, мы даже можем использовать mock. Затем мы могли бы использовать выходные данные в качестве точки установки для какого-либо другого компонента в конвейере. Ниже приведен простой пример команд, которые могут это сделать, и их можно адаптировать к другим средам.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ tito build --test --srpm
Building package [dist-git-0.13-1]
Wrote: /tmp/tito/dist-git-git-0.efa5ab8.tar.gz

Wrote: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm

$ tito build --builder=mock --arg mock=epel-7-x86_64 --test --rpm
Building package [dist-git-0.13-1]
Creating rpms for dist-git-git-0.efa5ab8 in mock: epel-7-x86_64
Wrote: /tmp/tito/dist-git-git-0.efa5ab8.tar.gz

Wrote: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm

Using srpm: /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.fc23.src.rpm
Initializing mock...
Installing deps in mock...
Building RPMs in mock...
Wrote:
  /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm
  /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm

$ sudo yum localinstall /tmp/tito/dist-git-*.noarch.rpm
Loaded plugins: product-id, search-disabled-repos, subscription-manager
Examining /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm: dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch
Marking /tmp/tito/dist-git-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm to be installed
Examining /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm: dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch
Marking /tmp/tito/dist-git-selinux-0.13-1.git.0.efa5ab8.el7.centos.noarch.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package dist-git.noarch 0:0.13-1.git.0.efa5ab8.el7.centos will be installed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание, что последняя команда должна быть запущена либо с правами sudo, либо с правами root, и что большая часть выходных данных была опущена для краткости, поскольку список зависимостей довольно длинный.</p>
</div>
<div class="paragraph">
<p>На этом наш простой пример использования tito заканчивается, но в нем есть много удивительных функций для традиционных системных администраторов, разработчиков RPM-пакетов и практиков DevOps. Я бы настоятельно рекомендовал ознакомиться с upstream документацией, найденной на сайте <em>tito</em> GitHub, для получения дополнительной информации о том, как быстро начать использовать его для вашего проекта, а также о различных дополнительных функциях, которые он предлагает.</p>
</div>
</div>
<div class="sect3">
<h4 id="dist-git">dist-git</h4>
<div class="paragraph">
<p>Утилита  <a href="https://github.com/release-engineering/dist-git">dist-git</a> использует несколько иной подход, чем у
 <a href="https://github.com/dgoodwin/tito">tito</a>,
так что вместо того, чтобы хранить upstream исходный код в <a href="https://git-scm.com/">git</a>, она вместо этого будет хранить файлы спецификаций и патчи в репозитории git и загружать сжатый архив исходного кода в так называемый “look-aside cache”.
“Look-aside-cache” - это термин, который был придуман при использовании систем сборки RPM, хранящих большие файлы, подобные этим, “на стороне”. Подобная система, как правило, привязана к правильной системе сборки RPM, такой как  <a href="https://pagure.io/koji">Koji</a>.
Затем система сборки настраивается на извлечение элементов, которые перечислены в качестве записей
<code>SourceX</code> в файлах спецификаций, из этого внешнего кэша, в то время как спецификация и исправления остаются в системе контроля версий. Существует также вспомогательный инструмент командной строки, который поможет в этом.</p>
</div>
<div class="paragraph">
<p>Чтобы не дублировать документацию, для получения дополнительной информации о том, как настроить такую систему, пожалуйста, обратитесь к upstream документации
<a href="https://github.com/release-engineering/dist-git">dist-git</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="more-on-macros">Подробнее о макросах</h3>
<div class="paragraph">
<p>Существует множество встроенных макросов RPM, и мы рассмотрим некоторые из них в следующем разделе, однако исчерпывающий список можно найти на странице
<a href="https://rpm-software-management.github.io/rpm/manual/macros.html">RPM Official Documentation</a>.</p>
</div>
<div class="paragraph">
<p>Существуют также макросы, предоставляемые вашим дистрибутивом
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a> D, в этом разделе мы рассмотрим некоторые из них, предоставляемые
those provided by <a href="https://getfedora.org/">Fedora</a>,
<a href="https://www.centos.org/">CentOS</a> и
<a href="https://www.redhat.com/en/technologies/linux-platforms">RHEL</a>, а также предоставим информацию о том, как проверить вашу систему, чтобы узнать о других, которые мы не рассматриваем, или для их обнаружения в других дистрибутивах Linux на основе RPM</p>
</div>
<div class="sect3">
<h4 id="defining-your-own">Определение Ваших Собственных Макросов</h4>
<div class="paragraph">
<p>Вы можете определить свои собственные макросы. Ниже приводится выдержка из
<a href="https://rpm-software-management.github.io/rpm/manual/macros.html">RPM Official Documentation</a>,  в которой содержится исчерпывающая информация о возможностях макросов.</p>
</div>
<div class="paragraph">
<p>Чтобы определить макрос, используйте:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%global &lt;name&gt;[(opts)] &lt;body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Все пробелы, окружающие  <code>\ </code>, удаляются.  Имя может состоять из буквенно-цифровых символов и символа <code>_</code>  и должно иметь длину не менее 3 символов. A
Макрос без поля <code>(opts)</code> является “простым” в том смысле, что выполняется только рекурсивное расширение макроса. Параметризованный макрос содержит поле <code>(opts)</code> field. The
<code>opts</code> - (строка в круглых скобках) передается точно так же, как и в getopt(3)  для обработки
argc/argv  в начале вызова макроса.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Более старые файлы спецификаций RPM могут использовать шаблон макроса <code>%define &lt;name&gt; &lt;body&gt;</code>. Различия между макросами <code>%define</code> и <code>%global</code> заключаются в следующем:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>%define</code> имеет локальную область действия, что означает, что он применяется только к указанной части SPEC файла. IКроме того, тело макроса  <code>%define</code> расширяется при использовании.</p>
</li>
<li>
<p><code>%global</code> имеет глобальную область действия, что означает, что он применяется ко всему SPEC файлу.
Кроме того, тело макроса <code>%global</code> асширяется во время определения.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Пример:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>%global githash 0ec4e58
%global python_sitelib %(%{__python} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
MМакросы всегда оцениваются, даже в комментариях. Иногда это безобидно. Но во втором примере мы выполняем команду python, чтобы получить содержимое макроса. Эта команда будет выполняться даже тогда, когда вы закомментируете макрос. Или когда вы вводите имя макроса в%changelog. Чтобы закомментировать макрос, используйте
<code>%%</code>. Например: <code>%%global</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="setup">%setup</h4>
<div class="paragraph">
<p>Макрос  <code>%setup</code> ожно использовать для сборки пакета с помощью tarball исходного кода.
Стандартное поведение макроса <code>%setup</code> можно увидеть в выходных данных <code>rpmbuild</code>.
В начале каждой фазы макрос выводит <code>Executing(%something)</code>.
Например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.DhddsG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Выходные данные оболочки устанавливаются с включенным <code>set -x</code>. Чтобы просмотреть содержимое
<code>/var/tmp/rpm-tmp.DhddsG</code>, используйте опцию <code>--debug</code>, поскольку <code>rpmbuild</code> удаляет временные файлы после успешной сборки. Здесь отображается настройка переменных среды, например:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd '/builddir/build/BUILD'
rm -rf 'cello-1.0'
/usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xof -
STATUS=$?
if [ $STATUS -ne 0 ]; then
  exit $STATUS
fi
cd 'cello-1.0'
/usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Макрос <code>%setup</code> гарантирует, что мы работаем в правильном каталоге, удаляет остатки предыдущих сборок, распаковывает исходный архив и устанавливает некоторые привилегии по умолчанию. Существует несколько вариантов настройки поведения макроса
<code>%setup</code>.</p>
</div>
<div class="sect4">
<h5 id="setup-q">%setup -q</h5>
<div class="paragraph">
<p>Параметр <code>-q</code>  ограничивает детализацию макроса  <code>%setup</code>. Вместо <code>tar -xof</code> выполняется только <code>tar -xvvof</code>. Этот параметр должен быть использован в качестве первого.</p>
</div>
</div>
<div class="sect4">
<h5 id="setup-n">%setup -n</h5>
<div class="paragraph">
<p>В некоторых случаях каталог из расширенного архива имеет другое имя, чем ожидалось <code>%{name}-%{version}</code>. Это может привести к ошибке макроса <code>%setup</code>.  Имя каталога должно быть указано параметром <code>-n directory_name</code>.</p>
</div>
<div class="paragraph">
<p>Например, если имя пакета  <code>cello</code>, , но исходный код заархивирован в <code>hello-1.0.tgz</code> и содержит каталог <code>hello/</code> содержимое SPEC файла должно быть:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Name: cello
Source0: https://example.com/%{name}/release/hello-%{version}.tar.gz
…
%prep
%setup -n hello</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setup-c">%setup -c</h5>
<div class="paragraph">
<p>Параметр  <code>-c</code> можно использовать, если архив исходного кода не содержит никаких подкаталогов и после распаковки файлы из архива заполняют текущий каталог. Опция <code>-c</code> создает каталог и переходит к расширению архива. Наглядный пример:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/usr/bin/mkdir -p cello-1.0
cd 'cello-1.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Каталог не изменяется после расширения архива.</p>
</div>
</div>
<div class="sect4">
<h5 id="setup-dt">%setup -D and -T</h5>
<div class="paragraph">
<p><code>-D</code>  отключает удаление каталога исходного кода. Этот параметр полезен, если макрос <code>%setup</code> mиспользуется несколько раз. По сути, параметр <code>-D</code> означает, что сделующие строки не используются:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rm -rf 'cello-1.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Параметр<code>-T</code> отключает расширение хранилища исходного кода, удаляя следующую строку из скрипта:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xvvof -</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setup-ab">%setup -a and -b</h5>
<div class="paragraph">
<p>Параметры <code>-a</code> и <code>-b</code> расширяют определённые источники.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Параметр <code>-b</code> (расшифровывается как <code>before</code>) расширяет определенные источники перед входом в рабочий каталог.</p>
</li>
<li>
<p>Параметр <code>-a</code> (расшифровывается как  <code>after</code>) расширяет эти источники после входа. Их аргументами являются исходные номера из преамбулы файла спецификации.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Например, допустим, что <code>cello-1.0.tar.gz</code> архив содержит пустой каталог <code>examples</code>, и примеры поставляются в отдельных
<code>examples.tar.gz</code> tarball, и они разархивируются в каталог с тем же именем. В этом случае используйте <code>-a 1</code>, так как мы хотим разархивировать <code>Source1</code> после входа в рабочий каталог:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Source0: https://example.com/%{name}/release/%{name}-%{version}.tar.gz
Source1: examples.tar.gz
…
%prep
%setup -a 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Но если бы примеры были в отдельном <code>cello-1.0-examples.tar.gz</code> tarball,
который расширяется до <code>cello-1.0/examples</code>, используйте параметры <code>-b 1</code>, поскольку
<code>Source1</code> должен быть разархивирован перед входом в рабочий каталог:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">Source0: https://example.com/%{name}/release/%{name}-%{version}.tar.gz
Source1: %{name}-%{version}-examples.tar.gz
…
%prep
%setup -b 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вы также можете использовать комбинацию всех этих опций.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="files">%files</h4>
<div class="paragraph">
<p>Общие  “расширенные” макросы RPM, необходимые в разделе <code>%files</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Макрос</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Описание</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Это идентифицирует файл, указанный в списке как файл ЛИЦЕНЗИИ, и он будет установлен и помечен как таковой RPM. Пример: <code>%license LICENSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TЭто идентифицирует файл, указанный как документация, и он будет установлен и помечен RPM как таковой. Это часто используется не только для документации об упаковываемом программном обеспечении, но и для примеров кода и различных элементов, которые должны сопровождать документацию. Пример: <code>%doc README</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Указывает, что путь является каталогом, которым должен владеть этот RPM. Это важно, чтобы манифест RPM-файла точно знал, какие каталоги очищать при удалении. Пример: <code>%dir %{_libdir}/%{name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%config(noreplace)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Указывает, что следующий файл является файлом конфигурации и поэтому не должен перезаписываться (или заменяться) при установке или обновлении пакета, если файл был изменен по сравнению с исходной контрольной установкой. В случае внесения изменений файл будет создан с добавлением <code>.rpmnew</code> в конец имени файла при обновлении или установке, чтобы ранее существующий или измененный файл в целевой системе не был изменен. Пример: <code>%config(noreplace) %{_sysconfdir}/%{name}/%{name}.conf</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="built-in-macros">Встроенные макросы</h4>
<div class="paragraph">
<p>В вашей системе есть много встроенных макросов RPM, и самый быстрый способ просмотреть их все - это просто выполнить команду <code>rpm --showrc</code>. Обратите внимание, что это будет содержать много выходных данных, поэтому его часто используют в сочетании с каналом для <code>grep</code>.</p>
</div>
<div class="paragraph">
<p>Вы также можете найти информацию о макросах RPM, которые поставляются непосредственно с версией RPM вашей системы, просмотрев выходные данные   <code>rpm -ql rpm</code> , обратив внимание на файлы с названием <code>macros</code> в структуре каталогов.</p>
</div>
</div>
<div class="sect3">
<h4 id="rpm-distribution-macros">RPM Distribution Macros</h4>
<div class="paragraph">
<p>Различные дистрибутивы будут предоставлять разные наборы рекомендуемых макросов RPM в зависимости от языковой реализации упаковываемого программного обеспечения или конкретных рекомендаций рассматриваемого дистрибутива.</p>
</div>
<div class="paragraph">
<p>Они часто предоставляются в виде самих пакетов RPM и могут быть установлены с пакетного менеджера, такого как <a href="http://yum.baseurl.org/">yum</a> или
<a href="https://github.com/rpm-software-management/dnf">dnf</a>. Сами файлы макросов после установки можно найти в <code>/usr/lib/rpm/macros.d/</code> и они будут включены в вывод <code>rpm --showrc</code> по умолчанию после установки.</p>
</div>
<div class="paragraph">
<p>Одним из основных примеров этого является раздел
<a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/">Fedora Packaging
Guidelines</a> относящийся конкретно к
<a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/_domain_specific_guidelines">Application
Specific Guidelines</a>, который на момент написания этой статьи содержит более 60 различных наборов руководств вместе с соответствующими наборами макросов RPM для конкретной упаковки RPM.</p>
</div>
<div class="paragraph">
<p>Одним из примеров такого рода RPM может быть для  <a href="https://www.python.org/">Python</a>
версии 2.x, и если у нас установлен пакет <code>python2-rpm-macros</code>
(доступный в EPEL для RHEL 7 и CentOS 7), у нас есть ряд доступных нам специфичных для python2 макросов.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm -ql python2-rpm-macros
/usr/lib/rpm/macros.d/macros.python2

$ rpm --showrc | grep python2
-14: __python2  /usr/bin/python2
CFLAGS="%{optflags}" %{__python2} %{py_setup} %{?py_setup_args} build --executable="%{__python2} %{py2_shbang_opts}" %{?1}
CFLAGS="%{optflags}" %{__python2} %{py_setup} %{?py_setup_args} install -O1 --skip-build --root %{buildroot} %{?1}
-14: python2_sitearch   %(%{__python2} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib(1))")
-14: python2_sitelib    %(%{__python2} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")
-14: python2_version    %(%{__python2} -c "import sys; sys.stdout.write('{0.major}.{0.minor}'.format(sys.version_info))")
-14: python2_version_nodots     %(%{__python2} -c "import sys; sys.stdout.write('{0.major}{0.minor}'.format(sys.version_info))")</code></pre>
</div>
</div>
<div class="paragraph">
<p>В приведенном выше выводе отображаются необработанные определения макросов RPM, но нас, вероятно, больше интересует, что они будут оценивать, что мы можем сделать с помощью <code>rpm --eval</code> , чтобы определить, что они делают, а также как они могут быть полезны для нас при упаковке RPMs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --eval %{__python2}
/usr/bin/python2

$ rpm --eval %{python2_sitearch}
/usr/lib64/python2.7/site-packages

$ rpm --eval %{python2_sitelib}
/usr/lib/python2.7/site-packages

$ rpm --eval %{python2_version}
2.7

$ rpm --eval %{python2_version_nodots}
27</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-macros">Пользовательские макросы</h3>
<div class="paragraph">
<p>Вы можете переопределить макросы в файле <code>~/.rpmmacros</code>. Любые внесенные вами изменения повлияют на каждую сборку на вашем компьютере.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Существует несколько макросов, которые Вы можете использовать для переопределения</dt>
<dt class="hdlist1"><code>%_topdir /opt/some/working/directory/rpmbuild</code></dt>
<dd>
<p>Вы можете создать этот каталог, включая все подкаталоги, с помощью утилиты <code>rpmdev-setuptree</code>.
Значение этого макроса по умолчанию равно<code>~/rpmbuild</code>.</p>
</dd>
<dt class="hdlist1"><code>%_smp_mflags -l3</code></dt>
<dd>
<p>Этот макрос часто используется для передачи в Makefile, например
<code>make %{?_smp_mflags}</code>, и для задания количества одновременных процессов на этапе сборки. По умолчанию для него задано значение <code>-jX</code>, где X - количество ядер. Если вы измените количество ядер, Вы можете ускорить или замедлить сборку пакетов.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Хотя Вы можете определить любые новые макросы в файле <code>~/.rpmmacros</code>  это не рекомендуется, поскольку эти макросы не будут присутствовать на других компьютерах, гд е пользователи могут захотеть попытаться пересобрать Ваш пакет.</p>
</div>
</div>
<div class="sect2">
<h3 id="epoch-scriptlets-and-triggers">Epoch, Scriptlets, and Triggers</h3>
<div class="paragraph">
<p>В мире SPEC бфайлов  RPM существуют различные разделы, которые считаются продвинутыми, поскольку они влияют не только на файл спецификации, способ сборки пакета, но и на конечный компьютер, на который устанавливается результирующий RPM. В этом разделе мы рассмотрим наиболее распространенные из них, такие как Epoch, Скриптлеты и триггеры.</p>
</div>
<div class="sect3">
<h4 id="epoch">Epoch</h4>
<div class="paragraph">
<p>Первым в списке стоит <code>Epoch</code>, epoch - это способ определения взвешенных зависимостей на основе номеров версий. Его значение по умолчанию равно 0, и это предполагается, если директива
<code>Epoch</code>  не указана в SPEC файле. Это не рассматривалось в разделе "SPEC файл" этого руководства, потому что почти всегда вводить значени Epoch  - плохая идея, поскольку это искажает то, что вы обычно ожидаете от RPM при сравнении версий пакетов.</p>
</div>
<div class="paragraph">
<p>Например, если был установлен пакет <code>foobar</code> с <code>Epoch: 1</code> и <code>Version: 1.0</code>, а кто-то другой упаковал <code>foobar</code> с<code>Version: 2.0</code> , но просто опустил директиву <code>Epoch</code> либо потому, что они не знали о ее необходимости, либо просто забыли, эта новая версия никогда не будет считаться обновлением, потому что версия Epoch превалирует над традиционным маркером
Name-Version-Release, который означает управление версиями для RPM-пакетов.</p>
</div>
<div class="paragraph">
<p>Этот подход обычно используется только в случае крайней необходимости (в крайнем случае) для решения проблемы с порядком обновления, которая может возникнуть как побочный эффект upstream программного обеспечения, изменяющего схемы нумерации версий или версии, включающие буквенные символы, которые не всегда можно надежно сравнить на основе кодирование.</p>
</div>
</div>
<div class="sect3">
<h4 id="triggers-and-scriptlets">Scriptlets and Triggers</h4>
<div class="paragraph">
<p>В пакетах RPM существует ряд директив, которые можно использовать для внесения необходимых или желаемых изменений в систему во время установки RPM. Они называются <strong>scriptlets</strong>.</p>
</div>
<div class="paragraph">
<p>Один из основных примеров того, когда и почему вы хотели бы это сделать, - это когда установлена системная служба RPM и она предоставляет
<a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a>
<a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">файл</a>.
Во время установки нам нужно будет уведомить
<a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a>  о появлении нового модуля, чтобы системный администратор мог выполнить команду, аналогичную  <code>systemctl start
foo.service</code> после установки вымышленного <code>foo</code> (который в этом примере предоставляет демон). Аналогично, нам нужно было бы отменить это действие при деинсталляции, чтобы администратор не получал ошибок из-за того, что двоичный файл демона больше не установлен, но файл модуля все еще существует в запущенной конфигурации systemd.</p>
</div>
<div class="paragraph">
<p>Существует небольшая горстка распространенных директив скриптлета, они похожи на “заголовки разделов”, такие как <code>%build</code> or <code>%install</code>, в том смысле, что они определяются многострочными сегментами кода, часто написанными как стандартный сценарий оболочки
<a href="https://en.wikipedia.org/wiki/POSIX">POSIX</a>
, но могут быть на нескольких разных языках программирования, так что RPM для дистрибутива целевой машины настроен таким образом, чтобы они разрешались. A
Исчерпывающий список этих доступных языков можно найти в <em>Официальной документации RPM</em>.</p>
</div>
<div class="paragraph">
<p>Следующие скриптлет директивы:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Директива</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Описание</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Скриптлет, который выполняется непосредственно перед установкой пакета в целевую систему.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%post</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Скриптлет, который выполняется сразу после установки пакета в целевой системе.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%preun</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Скриптлет, который выполняется непосредственно перед удалением пакета из целевой системы.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%postun</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Скриптлет, который выполняется сразу после удаления пакета из целевой системы.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Также часто для этой функции существуют макросы RPM.  В нашем предыдущем примере мы обсуждали необходимость получения  <a href="https://freedesktop.org/wiki/Software/systemd/">systemd</a>
уведомления о новом
<a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">unit file</a>,
, это легко обрабатывается макросами скриптлета systemd, как мы можем видеть из приведенного ниже примера вывода.  Более подробную информацию об этом можно найти в
<a href="https://fedoraproject.org/wiki/Packaging:Systemd">Fedora systemd Packaging
Guidelines</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ rpm --showrc | grep systemd
-14: __transaction_systemd_inhibit      %{__plugindir}/systemd_inhibit.so
-14: _journalcatalogdir /usr/lib/systemd/catalog
-14: _presetdir /usr/lib/systemd/system-preset
-14: _unitdir   /usr/lib/systemd/system
-14: _userunitdir       /usr/lib/systemd/user
/usr/lib/systemd/systemd-binfmt %{?*} &gt;/dev/null 2&gt;&amp;1 || :
/usr/lib/systemd/systemd-sysctl %{?*} &gt;/dev/null 2&gt;&amp;1 || :
-14: systemd_post
-14: systemd_postun
-14: systemd_postun_with_restart
-14: systemd_preun
-14: systemd_requires
Requires(post): systemd
Requires(preun): systemd
Requires(postun): systemd
-14: systemd_user_post  %systemd_post --user --global %{?*}
-14: systemd_user_postun        %{nil}
-14: systemd_user_postun_with_restart   %{nil}
-14: systemd_user_preun
systemd-sysusers %{?*} &gt;/dev/null 2&gt;&amp;1 || :
echo %{?*} | systemd-sysusers - &gt;/dev/null 2&gt;&amp;1 || :
systemd-tmpfiles --create %{?*} &gt;/dev/null 2&gt;&amp;1 || :

$ rpm --eval %{systemd_post}

if [ $1 -eq 1 ] ; then
        # Initial installation
        systemctl preset  &gt;/dev/null 2&gt;&amp;1 || :
fi

$ rpm --eval %{systemd_postun}

systemctl daemon-reload &gt;/dev/null 2&gt;&amp;1 || :

$ rpm --eval %{systemd_preun}

if [ $1 -eq 0 ] ; then
        # Package removal, not upgrade
        systemctl --no-reload disable  &gt; /dev/null 2&gt;&amp;1 || :
        systemctl stop  &gt; /dev/null 2&gt;&amp;1 || :
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Еще один элемент, который обеспечивает еще более детальный контроль над транзакцией RPM в целом, - это то, что известно как <strong>триггеры</strong>. По сути, это то же самое, что и скриптлет, но выполняется в очень определенном порядке операций во время транзакции установки или обновления RPM, что позволяет более точно контролировать весь процесс.</p>
</div>
<div class="paragraph">
<p>Порядок, в котором выполняется каждый из них, и подробная информация о котором приведена ниже.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">all-%pretrans
...
any-%triggerprein (%triggerprein from other packages set off by new install)
new-%triggerprein
new-%pre      for new version of package being installed
...           (all new files are installed)
new-%post     for new version of package being installed

any-%triggerin (%triggerin from other packages set off by new install)
new-%triggerin
old-%triggerun
any-%triggerun (%triggerun from other packages set off by old uninstall)

old-%preun    for old version of package being removed
...           (all old files are removed)
old-%postun   for old version of package being removed

old-%triggerpostun
any-%triggerpostun (%triggerpostun from other packages set off by old un
            install)
...
all-%posttrans</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вышеуказанные элементы взяты из прилагаемой документации RPM, найденной в
<code>/usr/share/doc/rpm/triggers</code> на системах Fedora и
<code>/usr/share/doc/rpm-4.*/triggers</code> в системах RHEL 7 и CentOS 7.</p>
</div>
<div class="sect4">
<h5 id="Using-Non-Shell-Scripts-in-spec-File">Using Non-Shell Scripts in SPEC File</h5>
<div class="paragraph">
<p>Параметр скриптлета <code>-p</code>, в SPEC файле позволяет вызывать определенный интерпретатор вместо стандартного <code>-p&#160;/bin/sh</code>. аглядным примером является скрипт, который выводит сообщение после установки <code>pello.py</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Откройте файл <code>pello.spec</code>.</p>
</li>
<li>
<p>Найдите следующую строку:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Под этой строкой вставьте следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="specfile">%post -p /usr/bin/python3
print("This is {} code".format("python"))</code></pre>
</div>
</div>
</li>
<li>
<p>Создайте свой пакет в соответствии с главой <a href="#building-rpms">Сборка RPMS</a>.</p>
</li>
<li>
<p>Установите Ваш пакет:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># dnf install /home/&lt;username&gt;/rpmbuild/RPMS/noarch/pello-0.1.1-1.fc27.noarch.rpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Результатом выполнения этой команды является следующее сообщение после установки:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Installing       : pello-0.1.1-1.fc27.noarch                              1/1
Running scriptlet: pello-0.1.1-1.fc27.noarch                              1/1
This is python code</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Чтобы использовать скрипт  Python&#160;3: Напишите строку <code>%post -p /usr/bin/python3</code>  под строкой <code>install -m</code> in a SPEC file.</p>
</li>
<li>
<p>Чтобы использовать крипт Lua: Напишите строку <code>%post -p &lt;lua&gt;</code> под строкой
<code>install&#160;-m</code> in a SPEC file.</p>
</li>
<li>
<p>Таким образом, в SPEC файле может быть указан любой интерпретатор.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rpm-conditionals">Условные обозначения RPM</h3>
<div class="paragraph">
<p>Условные обозначения RPM позволяют условно включать различные разделы SPEC файла.</p>
</div>
<div class="paragraph">
<p>Чаще всего условные обозначения имеют дело с:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>разделами, относящимся к конкретной архитектуре</p>
</li>
<li>
<p>разделами, относящимся к конкретной операционной системе</p>
</li>
<li>
<p>проблемами совместимости между различными версиями операционных систем</p>
</li>
<li>
<p>существованием и определением макросов</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_rpm_conditionals_syntax">RPM Conditionals Syntax</h4>
<div class="paragraph">
<p>Если <em>выражение</em> истинно, то выполните какое-нибудь действие:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if expression
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Если <em>выражение</em> истинно, то выполните какое-нибудь действие, в другом случае выполните другое действие:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if expression
...
%else
...
%endif</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_примеры_условных_обозначений_rpm">Примеры условных обозначений RPM</h4>
<div class="sect4">
<h5 id="_обозначение_if">Обозначение <code>%if</code></h5>
<div class="literalblock">
<div class="content">
<pre>%if 0%{?rhel} == 6
sed -i '/AS_FUNCTION_DESCRIBE/ s/^/#/' configure.in
sed -i '/AS_FUNCTION_DESCRIBE/ s/^/#/' acinclude.m4
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Это условие обрабатывает совместимость между  RHEL6 и другими операционными системами с точки зрения поддержки макроса AS_FUNCTION_DESCRIBE. Когда пакет создается для RHEL, определяется макрос <code>%rhel</code> , и он расширяется до версии RHEL. Если его значение равно 6, что означает, что пакет создан для RHEL 6, , то ссылки на
AS_FUNCTION_DESCRIBE, который не поддерживается RHEL6,  удаляются из сценариев автоконфигурации.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if 0%{?el6}
%global ruby_sitearch %(ruby -rrbconfig -e 'puts Config::CONFIG["sitearchdir"]')
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Это условие регулирует совместимость между Fedora версии 17 и новее и RHEL 6 с точки зрения поддержки макроса  <code>%ruby_sitearch</code> macro. . Fedora версии 17 и никогда не определяет <code>%ruby_sitearch</code> bпо умолчанию, но RHEL6 не поддерживает этот макрос. Условие проверяет, является ли операционная система RHEL 6. Если это так,
<code>%ruby_sitearch</code> определяется явно. Обратите внимание, что  <code>0%{?el6}</code> имеет то же значение, что и <code>0%{?rhel} == 6</code> из предыдущего примера, и он проверяет, построен ли пакет на RHEL 6.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%if 0%{?fedora} &gt;= 19
%global with_rubypick 1
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Это условие обрабатывает поддержку инструмента выбора ruby. Если операционная система Fedora версии 19 или новее, поддерживается rubypick.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%define ruby_archive %{name}-%{ruby_version}
%if 0%{?milestone:1}%{?revision:1} != 0
%define ruby_archive %{ruby_archive}-%{?milestone}%{?!milestone:%{?revision:r%{revision}}}
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Это условие обрабатывает определение макросов. Если заданы макросы <code>%milestone</code> или
<code>%revision</code>, переопределяется макрос <code>%ruby_archive</code>, который определяет имя вышестоящего файла архива.</p>
</div>
</div>
<div class="sect4">
<h5 id="_специальные_варианты_обозначения_if">Специальные варианты обозначения <code>%if</code></h5>
<div class="paragraph">
<p>Условные обозначения <code>%ifarch</code>, <code>%ifnarch</code> и <code>%ifos</code> являются специализированными вариантами условных обозначений <code>%if</code>. Эти варианты обычно используются, поэтому у них есть свои собственные макросы.</p>
</div>
<div class="sect5">
<h6 id="_обозначениеifarch">Обозначение`%ifarch`</h6>
<div class="paragraph">
<p>Условие <code>%ifarch</code> спользуется для начала блока файла спецификации, который зависит от архитектуры. За ним следует один или несколько спецификаторов архитектуры, каждый из которых разделен запятыми или пробелами.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%ifarch i386 sparc
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Все содержимое SPEC файла между <code>%ifarch</code> и <code>%endif</code> обрабатывается только на 32-разрядных архитектурах AMD и Intel или системах на базе Sun SPARC.</p>
</div>
</div>
<div class="sect5">
<h6 id="_условное_обозначение_ifnarch">Условное обозначение <code>%ifnarch</code></h6>
<div class="paragraph">
<p>Условие <code>%ifnarch</code> cимеет обратную логику, чем условие  <code>%ifarch</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%ifnarch alpha
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Все содержимое SPEC файла между <code>%ifnarch</code> и <code>%endif</code> обрабатывается только в том случае, если это не выполняется в системе на основе Digital Alpha/AXP.</p>
</div>
</div>
<div class="sect5">
<h6 id="_условие_ifos">Условие <code>%ifos</code></h6>
<div class="paragraph">
<p>Условие <code>%ifos</code>  используется для управления обработкой на основе операционной системы сборки. За ним может следовать одно или несколько имен операционной системы.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%ifos linux
...
%endif</pre>
</div>
</div>
<div class="paragraph">
<p>Все содержимое файла спецификации между <code>%ifos</code> и <code>%endif</code> обрабатывается только в том случае, если сборка была выполнена в системе Linux.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_новые_возможности_rpm_в_rhel_7">Appendix A: Новые возможности RPM в RHEL 7</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Этот список документирует наиболее заметные изменения в упаковке RPM между Red Hat Enterprise Linux 6 и 7.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Добавлена новая команда, <code>rpmkeys</code>, используемая для импорта связки ключей и проверки подписи.</p>
</li>
<li>
<p>Добавлена новая команда, <code>rpmspec</code>, используемая для запросов спецификаций и анализируемых выходных данных.</p>
</li>
<li>
<p>Добавлена новая команда, <code>rpmsign</code>,  используемая для подписи пакета.</p>
</li>
<li>
<p>Расширения  <code>posix.exec()</code>  и <code>os.exit()</code> встроенные в  <code>%{lua:&#8230;&#8203;}</code>
скрипты, завершают работу скрипта с ошибкой, если они не вызываются из дочернего процесса, созданного с помощью скриптлета
<code>posix.fork()</code>.</p>
</li>
<li>
<p>Сбой скриптлета <code>%pretrans</code>  приводит к пропуску установки пакета</p>
</li>
<li>
<p>Скриптлеты могут быть развернуты макросом и развернуты в формате запроса во время выполнения.</p>
</li>
<li>
<p>Зависимости скриптлетов до транзакции и после транзакции теперь могут быть правильно выражены с помощью  <code>Requires(pretrans)</code> , <code>Requires(posttrans)</code> и
скриптлетов.</p>
</li>
<li>
<p>Добавлен тег <code>OrderWithRequires</code>  для предоставления дополнительных подсказок. Тег следует синтаксису тега  <code>Requires</code>, но не создает фактических зависимостей. Подсказки по порядку обрабатываются так, как если бы они были <code>Requires</code> при расчете порядка транзакции, только если задействованные пакеты присутствуют в одной и той же транзакции.</p>
</li>
<li>
<p>The <code>%license</code> Этот флаг можно использовать в разделе <code>%files`. Этот флаг можно использовать аналогично флагу </code>%doc<code> для пометки файлов как лицензий, которые необходимо установить, несмотря на параметр </code>--nodocs``.</p>
</li>
<li>
<p>Добавлен макрос <code>%autosetup</code> для автоматизации применения исправлений с дополнительной интеграцией с распределенной системой контроля версий.</p>
</li>
<li>
<p>Автоматический генератор зависимостей был переписан в расширяемую и настраиваемую систему на основе правил со встроенной фильтрацией.</p>
</li>
<li>
<p>Открытые ключи OpenPGP V3 больше не поддерживаются.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ссылки_на_источники">Appendix B: Ссылки на источники</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ниже приведены ссылки на различные темы, представляющие интерес для RPM, упаковки RPM и построения RPM. Некоторые из них являются продвинутыми и выходят далеко за рамки вводного материала, включенного в данное руководство.</p>
</div>
<div class="paragraph">
<p><a href="https://www.softwarecollections.org/en/">Software Collections</a> -
SoftwareCollections.org это проект с открытым исходным кодом для создания и распространения поддерживаемых сообществом коллекций программного обеспечения (SCL) для Red Hat Enterprise Linux,
Fedora, CentOS, и Scientific Linux.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.fedoraproject.org/en-US/quick-docs/creating-rpm-packages/index.html">Creating
RPM package</a> - Пошаговое руководство по изучению основ упаковки RPM.</p>
</div>
<div class="paragraph">
<p><a href="http://www.ibm.com/developerworks/library/l-rpm1/">Packaging software with
RPM, Part 1</a>, <a href="http://www.ibm.com/developerworks/library/l-rpm2/">Part 2</a>,
<a href="http://www.ibm.com/developerworks/library/l-rpm3/">Part 3</a> -
Руководство по упаковке IBM RPM.</p>
</div>
<div class="paragraph">
<p><a href="http://rpm.org/documentation">RPM Documentation</a> -
Официальная документация RPM.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/">Fedora Packaging
Guidelines</a> -
Официальные рекомендации по упаковке для Fedora, полезные для всех дистрибутивов на основе RPM.</p>
</div>
<div class="paragraph">
<p><a href="https://pagure.io/rpmfluff">rpmfluff</a> - библиотека python для создания пакетов RPM и их саботажа, чтобы они были взломаны контролируемыми способами.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_выражение_благодарности">Appendix C: Выражение благодарности</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Некоторые фрагменты этого текста впервые появились в
<a href="https://rpm-packaging-guide.github.io/">RPM Packaging Guide</a>. Copyright
&copy; 2020 Adam Miller and others. Лицензировано в соответствии с
<a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
Attribution-ShareAlike 3.0 Unported License</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-08-21 02:57:33 +0400
</div>
</div>
</body>
</html>
